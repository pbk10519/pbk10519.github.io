<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•ŒíŒŒë²³ ë±€ ì£¼ì‚¬ìœ„ ê²Œì„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="../styles/style.css">
    <style>
        /* Page Specific Styles */
        body {
            user-select: none;
        }

        /* ê²Œì„ ë³´ë“œ ê·¸ë¦¬ë“œ ì„¤ì • (ë±€ ëª¨ì–‘ ë°°ì¹˜) */
        .board-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            grid-template-rows: repeat(6, 1fr);
            gap: 4px;
            width: 100%;
            max-width: 600px;
            aspect-ratio: 1/1;
            margin: 0 auto;
            background: #fff;
            padding: 10px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        /* SVG ì˜¤ë²„ë ˆì´ (ë±€/ì‚¬ë‹¤ë¦¬ ì„  ê·¸ë¦¬ê¸°ìš©) */
        .board-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            /* í´ë¦­ í†µê³¼ */
            z-index: 5;
            padding: 10px;
            /* ê·¸ë¦¬ë“œ íŒ¨ë”©ê³¼ ë§ì¶¤ */
            box-sizing: border-box;
            overflow: visible;
            /* í™”ì‚´í‘œê°€ ì§¤ë¦¬ì§€ ì•Šê²Œ */
        }

        .cell {
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            background-color: #fff;
            font-size: 1.2rem;
            color: #475569;
            transition: all 0.3s;
            z-index: 2;
            /* ì„ ë³´ë‹¤ ìœ„ì— */
        }

        /* ë±€ê³¼ ì‚¬ë‹¤ë¦¬ ì‹œê°ì  í‘œì‹œ (ê°„ë‹¨í•œ ë°°ê²½ìƒ‰ êµ¬ë¶„) */
        .cell.snake {
            background-color: #fecaca;
            border-color: #f87171;
        }

        .cell.ladder {
            background-color: #bbf7d0;
            border-color: #4ade80;
        }

        .cell.start {
            background-color: #fef08a;
            border-color: #facc15;
        }

        .cell.finish {
            background-color: #ddd6fe;
            border-color: #a78bfa;
        }

        .cell-number {
            font-size: 0.7rem;
            position: absolute;
            top: 2px;
            left: 4px;
            color: #94a3b8;
        }

        .cell-content {
            font-size: 1.5rem;
            font-weight: bold;
        }

        /* í”Œë ˆì´ì–´ ë§ (í¬ê¸° í™•ëŒ€) */
        .player-token {
            width: 40px;
            /* ê¸°ì¡´ 28px -> 40px í™•ëŒ€ */
            height: 40px;
            border-radius: 50%;
            position: absolute;
            border: 3px solid white;
            /* í…Œë‘ë¦¬ ì¡°ê¸ˆ ë” êµµê²Œ */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            transition: top 0.5s cubic-bezier(0.34, 1.56, 0.64, 1), left 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            /* í†µí†µ íŠ€ëŠ” íš¨ê³¼ */
            z-index: 20;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            /* ê¸€ì í¬ê¸°ë„ í™•ëŒ€ */
            color: white;
            font-weight: bold;
        }

        /* ì£¼ì‚¬ìœ„ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes roll {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .rolling {
            animation: roll 0.5s linear infinite;
        }

        /* ëª¨ë‹¬ */
        .modal {
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
        }

        .hidden {
            display: none !important;
        }

        /* ì´ë²¤íŠ¸ ì•Œë¦¼ íŒì—… */
        .event-popup {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            z-index: 50;
            text-align: center;
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 4px solid;
            min-width: 200px;
        }

        .event-popup.good {
            border-color: #4ade80;
            color: #15803d;
        }

        .event-popup.bad {
            border-color: #f87171;
            color: #b91c1c;
        }

        @keyframes popIn {
            from {
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 0;
            }

            to {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }
    </style>
</head>

<body class="flex flex-col items-center">

    <!-- ë‚´ë¹„ê²Œì´ì…˜ ë©”ë‰´ -->
    <nav class="nav-container">
        <ul class="nav-menu">
            <li class="nav-item"><a href="../index.html" class="nav-link">ğŸ  í™ˆ</a></li>
            <li class="nav-item"><a href="seatingarrangement.html" class="nav-link">ìë¦¬ë°°ì¹˜</a></li>
            <li class="nav-item"><a href="role.html" class="nav-link">1ì¸ 1ì—­</a></li>
            <li class="nav-item"><a href="candy.html" class="nav-link">ìƒí’ˆ ë½‘ê¸°</a></li>
            <li class="nav-item"><a href="99.html" class="nav-link">êµ¬êµ¬ë‹¨</a></li>
            <li class="nav-item"><a href="alphabet.html" class="nav-link active">ì•ŒíŒŒë²³</a></li>
            <li class="nav-item"><a href="spelling.html" class="nav-link">ë§ì¶¤ë²•</a></li>
        </ul>
    </nav>

    <div class="page-container flex flex-col items-center justify-center">

        <!-- 1. ì„¤ì • í™”ë©´ -->
        <div id="setup-screen" class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-md text-center">
            <h1 class="text-4xl text-blue-500 mb-2 whitespace-nowrap">ğŸ ì•ŒíŒŒë²³ ë±€ ì£¼ì‚¬ìœ„ ğŸ²</h1>
            <p class="text-gray-500 mb-6 whitespace-nowrap">ì•ŒíŒŒë²³ì„ ë°°ìš°ë©° ì¹œêµ¬ë“¤ê³¼ ê²½ìŸí•´ìš”!</p>

            <div class="space-y-4 mb-6">
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 rounded-full bg-red-500"></div>
                    <input type="text" id="p1-name" placeholder="í”Œë ˆì´ì–´ 1 ì´ë¦„"
                        class="flex-1 p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-red-400">
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 rounded-full bg-blue-500"></div>
                    <input type="text" id="p2-name" placeholder="í”Œë ˆì´ì–´ 2 ì´ë¦„ (ì„ íƒ)"
                        class="flex-1 p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400">
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 rounded-full bg-green-500"></div>
                    <input type="text" id="p3-name" placeholder="í”Œë ˆì´ì–´ 3 ì´ë¦„ (ì„ íƒ)"
                        class="flex-1 p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-400">
                </div>
            </div>

            <button onclick="startGame()"
                class="w-full bg-indigo-500 hover:bg-indigo-600 text-white text-xl py-4 rounded-xl shadow-lg transition transform hover:scale-105">
                ê²Œì„ ì‹œì‘! ğŸš€
            </button>
        </div>

        <!-- 2. ê²Œì„ í™”ë©´ -->
        <div id="game-screen" class="hidden w-full max-w-5xl flex flex-col md:flex-row gap-6">

            <!-- ì™¼ìª½: ê²Œì„ ë³´ë“œ -->
            <div class="flex-1 flex justify-center">
                <div id="board-container" class="relative w-full max-w-[600px]">
                    <div id="board" class="board-grid">
                        <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ì…€ ìƒì„± -->
                    </div>
                    <!-- SVG ì˜¤ë²„ë ˆì´ (ì„  ê·¸ë¦¬ê¸°) -->
                    <svg id="board-overlay" class="board-overlay" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <!-- í™”ì‚´í‘œ ë§ˆì»¤ ì •ì˜ -->
                            <marker id="arrowhead-up" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
                                <path d="M0,0 L8,3 L0,6" fill="#4ade80" />
                            </marker>
                            <marker id="arrowhead-down" markerWidth="8" markerHeight="6" refX="7" refY="3"
                                orient="auto">
                                <path d="M0,0 L8,3 L0,6" fill="#f87171" />
                            </marker>
                        </defs>
                        <!-- ì„ ë“¤ì´ ì—¬ê¸°ì— ê·¸ë ¤ì§‘ë‹ˆë‹¤ -->
                    </svg>
                    <!-- ì´ë²¤íŠ¸ íŒì—… ì»¨í…Œì´ë„ˆ -->
                    <div id="popup-container"></div>
                </div>
            </div>

            <!-- ì˜¤ë¥¸ìª½: ì»¨íŠ¸ë¡¤ íŒ¨ë„ -->
            <div class="w-full md:w-80 flex flex-col gap-4">
                <!-- í˜„ì¬ í„´ ì •ë³´ -->
                <div class="bg-white p-6 rounded-2xl shadow-lg text-center">
                    <h2 class="text-2xl text-gray-700 mb-2">ëˆ„êµ¬ ì°¨ë¡€ì¼ê¹Œìš”?</h2>
                    <div id="current-player-display" class="text-3xl font-bold text-indigo-600 mb-4 animate-bounce">
                        í”Œë ˆì´ì–´ 1
                    </div>

                    <!-- ì£¼ì‚¬ìœ„ ì˜ì—­ -->
                    <div
                        class="flex flex-col items-center justify-center gap-4 bg-gray-50 p-4 rounded-xl border border-gray-200">
                        <div id="dice-box"
                            class="w-20 h-20 bg-white border-4 border-indigo-200 rounded-xl flex items-center justify-center text-5xl shadow-inner text-indigo-500">
                            ğŸ²
                        </div>
                        <button id="roll-btn" onclick="rollDice()"
                            class="w-full bg-yellow-400 hover:bg-yellow-500 text-yellow-900 font-bold py-3 rounded-xl shadow-md transition transform hover:scale-105">
                            ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°!
                        </button>
                    </div>
                </div>

                <!-- í”Œë ˆì´ì–´ í˜„í™© -->
                <div class="bg-white p-6 rounded-2xl shadow-lg flex-1">
                    <h3 class="text-lg text-gray-500 mb-4 border-b pb-2">í”Œë ˆì´ì–´ ìœ„ì¹˜</h3>
                    <div id="player-stats" class="space-y-3">
                        <!-- JSë¡œ ì±„ì›Œì§ -->
                    </div>
                </div>

                <div
                    class="text-center text-sm text-gray-500 bg-white/50 p-3 rounded-lg border border-gray-100 shadow-sm">
                    <div class="flex items-center justify-center gap-2 mb-1">
                        <span class="text-xl">ğŸªœ</span>
                        <span>ì‚¬ë‹¤ë¦¬: ìœ„ë¡œ ì í”„!</span>
                    </div>
                    <div class="flex items-center justify-center gap-2">
                        <span class="text-xl">ğŸ</span>
                        <span>ë±€: ì•„ë˜ë¡œ ë¯¸ë„ëŸ¬ì§</span>
                    </div>
                    <div class="mt-2 text-xs text-gray-400">ë¬¸ì œë¥¼ ë§ì¶°ì•¼ ì´ë™í•  ìˆ˜ ìˆì–´ìš”.</div>
                </div>
            </div>
        </div>

        <!-- 3. í€´ì¦ˆ ëª¨ë‹¬ -->
        <div id="quiz-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal p-4">
            <div class="bg-white rounded-3xl shadow-2xl p-8 max-w-sm w-full text-center relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-4 bg-indigo-500"></div>

                <h2 class="text-2xl font-bold text-gray-800 mb-2">ì•ŒíŒŒë²³ í€´ì¦ˆ! ğŸ“</h2>
                <p class="text-gray-500 mb-6">ì´ ì•ŒíŒŒë²³ì€ í•œêµ­ì–´ë¡œ ì–´ë–»ê²Œ ì½ì„ê¹Œìš”?</p>

                <div id="quiz-letter" class="text-8xl font-bold text-indigo-600 mb-8 drop-shadow-md">A</div>

                <div id="quiz-options" class="grid grid-cols-2 gap-3">
                    <!-- ì˜µì…˜ ë²„íŠ¼ë“¤ì´ ì—¬ê¸°ì— ìƒì„±ë¨ -->
                </div>

                <div id="quiz-feedback" class="mt-4 h-6 text-lg font-bold"></div>
            </div>
        </div>

        <!-- 4. ê²°ê³¼ ëª¨ë‹¬ -->
        <div id="winner-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal p-4">
            <div class="bg-white rounded-3xl shadow-2xl p-8 max-w-sm w-full text-center">
                <div class="text-6xl mb-4">ğŸ†</div>
                <h2 class="text-3xl font-bold text-yellow-500 mb-2">ì¶•í•˜í•©ë‹ˆë‹¤!</h2>
                <p id="winner-name" class="text-2xl text-gray-800 font-bold mb-6">í”Œë ˆì´ì–´ ìŠ¹ë¦¬!</p>
                <button onclick="location.reload()"
                    class="w-full bg-indigo-500 text-white py-3 rounded-xl hover:bg-indigo-600">
                    ë‹¤ì‹œ í•˜ê¸°
                </button>
            </div>
        </div>

        <script>
            // --- ê²Œì„ ì„¤ì • ë° ë°ì´í„° ---
            const boardSize = 36; // 6x6 ê·¸ë¦¬ë“œ
            // ë±€ê³¼ ì‚¬ë‹¤ë¦¬ ìœ„ì¹˜ ì„¤ì •
            const jumps = {
                3: 16,  // ì‚¬ë‹¤ë¦¬
                12: 2,  // ë±€
                15: 25, // ì‚¬ë‹¤ë¦¬
                21: 32, // ì‚¬ë‹¤ë¦¬
                27: 5,  // í° ë±€
                34: 19  // ë±€
            };

            const alphabetData = [
                { char: 'A', sound: 'ì—ì´' }, { char: 'B', sound: 'ë¹„' }, { char: 'C', sound: 'ì”¨' },
                { char: 'D', sound: 'ë””' }, { char: 'E', sound: 'ì´' }, { char: 'F', sound: 'ì—í”„' },
                { char: 'G', sound: 'ì¥' },
                { char: 'H', sound: 'ì—ì´ì¹˜' }, { char: 'I', sound: 'ì•„ì´' }, { char: 'J', sound: 'ì œì´' },
                { char: 'K', sound: 'ì¼€ì´' }, { char: 'L', sound: 'ì—˜' }, { char: 'M', sound: 'ì— ' },
                { char: 'N', sound: 'ì—”' }, { char: 'O', sound: 'ì˜¤' }, { char: 'P', sound: 'í”¼' },
                { char: 'Q', sound: 'í' }, { char: 'R', sound: 'ì•Œ' }, { char: 'S', sound: 'ì—ìŠ¤' },
                { char: 'T', sound: 'í‹°' }, { char: 'U', sound: 'ìœ ' }, { char: 'V', sound: 'ë¸Œì´' },
                { char: 'W', sound: 'ë”ë¸”ìœ ' }, { char: 'X', sound: 'ì—‘ìŠ¤' }, { char: 'Y', sound: 'ì™€ì´' },
                { char: 'Z', sound: 'ì§€' }
            ];

            let players = [];
            let currentPlayerIndex = 0;
            let isMoving = false;

            function getLetterForPos(pos) {
                if (pos <= 0 || pos > boardSize) return '';
                const index = (pos - 1) % 26;
                return alphabetData[index].char;
            }

            // --- ì´ˆê¸°í™” ë° ë³´ë“œ ë Œë”ë§ ---
            function startGame() {
                const p1 = document.getElementById('p1-name').value.trim() || 'ì¹œêµ¬ 1';
                const p2 = document.getElementById('p2-name').value.trim();
                const p3 = document.getElementById('p3-name').value.trim();

                players.push({ name: p1, color: 'bg-red-500', pos: 0, id: 0 });
                if (p2) players.push({ name: p2, color: 'bg-blue-500', pos: 0, id: 1 });
                if (p3) players.push({ name: p3, color: 'bg-green-500', pos: 0, id: 2 });

                document.getElementById('setup-screen').classList.add('hidden');
                document.getElementById('game-screen').classList.remove('hidden');

                renderBoard();
                drawJumpLines(); // ì„  ê·¸ë¦¬ê¸°
                updateStats();
                updateTurnDisplay();

                // ì°½ í¬ê¸° ë³€ê²½ ì‹œ ì„  ë‹¤ì‹œ ê·¸ë¦¬ê¸°
                window.addEventListener('resize', drawJumpLines);
            }

            function renderBoard() {
                const board = document.getElementById('board');
                board.innerHTML = '';

                let cellOrder = [];
                for (let row = 5; row >= 0; row--) {
                    let rowCells = [];
                    for (let col = 0; col < 6; col++) {
                        let num = row * 6 + col + 1;
                        rowCells.push(num);
                    }
                    if (row % 2 === 1) rowCells.reverse();
                    cellOrder = cellOrder.concat(rowCells);
                }

                cellOrder.forEach(num => {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.id = `cell-${num}`;

                    if (num === 1) cell.classList.add('start');
                    else if (num === boardSize) cell.classList.add('finish');
                    else if (jumps[num] && jumps[num] > num) cell.classList.add('ladder');
                    else if (jumps[num] && jumps[num] < num) cell.classList.add('snake');

                    const content = document.createElement('div');
                    content.className = 'cell-content';

                    if (num === 1) content.innerText = "START";
                    else if (num === boardSize) content.innerText = "GOAL";
                    else {
                        const letter = getLetterForPos(num);
                        content.innerText = letter;
                    }

                    cell.innerHTML = `<span class="cell-number">${num}</span>`;
                    cell.appendChild(content);
                    board.appendChild(cell);
                });

                players.forEach(p => renderPlayerToken(p));
            }

            // SVGë¡œ ê³¡ì„  ê·¸ë¦¬ê¸° (ì‚¬ë‹¤ë¦¬, ë±€)
            function drawJumpLines() {
                const svg = document.getElementById('board-overlay');
                // ê¸°ì¡´ path ì‚­ì œ (defs ì œì™¸)
                const paths = svg.querySelectorAll('path:not(marker path)');
                paths.forEach(p => p.remove());

                const boardRect = document.getElementById('board').getBoundingClientRect();

                for (const [start, end] of Object.entries(jumps)) {
                    const startCell = document.getElementById(`cell-${start}`);
                    const endCell = document.getElementById(`cell-${end}`);

                    if (!startCell || !endCell) continue;

                    const startRect = startCell.getBoundingClientRect();
                    const endRect = endCell.getBoundingClientRect();

                    // ë³´ë“œ ë‚´ ìƒëŒ€ ì¢Œí‘œ ê³„ì‚°
                    const x1 = startRect.left + startRect.width / 2 - boardRect.left;
                    const y1 = startRect.top + startRect.height / 2 - boardRect.top;
                    const x2 = endRect.left + endRect.width / 2 - boardRect.left;
                    const y2 = endRect.top + endRect.height / 2 - boardRect.top;

                    const isLadder = end > parseInt(start);
                    const color = isLadder ? '#4ade80' : '#f87171';
                    const strokeWidth = isLadder ? 6 : 5;
                    const marker = isLadder ? 'url(#arrowhead-up)' : 'url(#arrowhead-down)';

                    // ê³¡ì„  ì œì–´ì  ê³„ì‚° (ì•½ê°„ íœ˜ì–´ì§€ê²Œ)
                    // ë‘ ì ì˜ ì¤‘ì  ê³„ì‚°
                    const mx = (x1 + x2) / 2;
                    const my = (y1 + y2) / 2;

                    // ìˆ˜ì§ ë²¡í„° ê³„ì‚° (ë‹¨ìˆœí™”: xì°¨ì´ê°€ í¬ë©´ yë°©í–¥ìœ¼ë¡œ íœ¨, ë°˜ëŒ€ë©´ xë°©í–¥)
                    // ë” êµ¬ë¶ˆê±°ë¦¬ê²Œ í•˜ë ¤ë©´ ì œì–´ì ì„ ë‘ ê°œ ì¨ì•¼ í•¨ (Cubic Bezier)

                    const path = document.createElementNS("http://www.w3.org/2000/svg", "path");

                    let d = "";
                    if (isLadder) {
                        // ì‚¬ë‹¤ë¦¬ëŠ” ë¶€ë“œëŸ¬ìš´ í˜¸ (Quadratic Bezier)
                        // ê³¡ë¥  ì •ë„
                        const curveOffset = 40;
                        // ë°©í–¥ì— ë”°ë¼ ì œì–´ì  ì¡°ì • (ë‹¨ìˆœí•˜ê²Œ ì˜¤ë¥¸ìª½ì´ë‚˜ ì™¼ìª½ìœ¼ë¡œ íœ˜ê²Œ)
                        const cx = mx + (x1 < x2 ? -curveOffset : curveOffset);
                        const cy = my;
                        d = `M ${x1} ${y1} Q ${cx} ${cy} ${x2} ${y2}`;
                    } else {
                        // ë±€ì€ Sì (Cubic Bezier)
                        // ë‘ ë²ˆ êº¾ì´ê²Œ í•˜ì—¬ êµ¬ë¶ˆê±°ë¦¬ëŠ” ëŠë‚Œ
                        const offsetX = (x2 - x1) / 2;
                        const offsetY = (y2 - y1) / 2;

                        // ì œì–´ì  1, 2
                        const cp1x = x1 + offsetX * 0.5 + 40;
                        const cp1y = y1 + offsetY * 0.5;

                        const cp2x = x1 + offsetX * 1.5 - 40;
                        const cp2y = y1 + offsetY * 1.5;

                        d = `M ${x1} ${y1} C ${cp1x} ${cp1y}, ${cp2x} ${cp2y}, ${x2} ${y2}`;
                    }

                    path.setAttribute("d", d);
                    path.setAttribute("fill", "none");
                    path.setAttribute("stroke", color);
                    path.setAttribute("stroke-width", strokeWidth);
                    path.setAttribute("stroke-linecap", "round");
                    path.setAttribute("opacity", "0.7");
                    path.setAttribute("marker-end", marker); // í™”ì‚´í‘œ ì ìš©

                    svg.appendChild(path);
                }
            }

            function renderPlayerToken(player) {
                const existing = document.getElementById(`token-${player.id}`);
                if (existing) existing.remove();

                const token = document.createElement('div');
                token.id = `token-${player.id}`;
                token.className = `player-token ${player.color}`;
                token.innerText = player.name[0];

                let targetPos = player.pos === 0 ? 1 : player.pos;
                const targetCell = document.getElementById(`cell-${targetPos}`);

                if (targetCell) {
                    targetCell.appendChild(token);
                    // ê²¹ì¹¨ ì²˜ë¦¬
                    const siblings = targetCell.querySelectorAll('.player-token');
                    if (siblings.length > 1) {
                        const offset = (siblings.length - 1) * 8; // ê°„ê²© ë„“í˜
                        token.style.transform = `translate(${offset}px, ${offset}px)`;
                    }
                }
            }

            function updateStats() {
                const stats = document.getElementById('player-stats');
                stats.innerHTML = players.map((p, idx) => `
                <div class="flex items-center justify-between p-2 rounded ${idx === currentPlayerIndex ? 'bg-indigo-50 border border-indigo-200' : ''}">
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 rounded-full ${p.color}"></div>
                        <span class="font-bold text-gray-700">${p.name}</span>
                    </div>
                    <span class="text-indigo-600 font-bold">${p.pos === 0 ? 'ì¶œë°œì„ ' : p.pos + 'ë²ˆ ì¹¸'}</span>
                </div>
            `).join('');
            }

            function updateTurnDisplay() {
                const p = players[currentPlayerIndex];
                const display = document.getElementById('current-player-display');
                display.innerText = p.name;
                display.style.color = p.id === 0 ? '#ef4444' : p.id === 1 ? '#3b82f6' : '#22c55e';
            }

            // --- ê²Œì„ ë¡œì§ ---
            function rollDice() {
                if (isMoving) return;
                isMoving = true;
                const btn = document.getElementById('roll-btn');
                const diceBox = document.getElementById('dice-box');

                btn.disabled = true;
                btn.classList.add('opacity-50');
                diceBox.classList.add('rolling');

                setTimeout(() => {
                    const diceVal = Math.floor(Math.random() * 6) + 1;
                    diceBox.classList.remove('rolling');
                    diceBox.innerText = diceVal;

                    handleMoveAttempt(diceVal);
                }, 600);
            }

            function handleMoveAttempt(diceVal) {
                const player = players[currentPlayerIndex];
                let nextPos = player.pos + diceVal;

                if (nextPos >= boardSize) {
                    finishMove(boardSize);
                    return;
                }

                const targetLetter = getLetterForPos(nextPos);

                if (!targetLetter) {
                    finishMove(nextPos);
                } else {
                    openQuiz(targetLetter, nextPos);
                }
            }

            function openQuiz(letter, targetPos) {
                const modal = document.getElementById('quiz-modal');
                const letterDisplay = document.getElementById('quiz-letter');
                const optionsContainer = document.getElementById('quiz-options');
                const feedback = document.getElementById('quiz-feedback');

                modal.classList.remove('hidden');
                letterDisplay.innerText = letter;
                feedback.innerText = '';
                optionsContainer.innerHTML = '';

                const correctData = alphabetData.find(d => d.char === letter);
                const correctAnswer = correctData.sound;

                let options = [correctAnswer];
                while (options.length < 4) {
                    const random = alphabetData[Math.floor(Math.random() * alphabetData.length)].sound;
                    if (!options.includes(random)) options.push(random);
                }
                options.sort(() => Math.random() - 0.5);

                options.forEach(opt => {
                    const btn = document.createElement('button');
                    btn.className = "bg-gray-100 hover:bg-indigo-100 text-gray-800 font-semibold py-4 px-2 rounded-xl border-2 border-transparent hover:border-indigo-300 transition";
                    btn.innerText = opt;
                    btn.onclick = () => checkAnswer(opt, correctAnswer, targetPos);
                    optionsContainer.appendChild(btn);
                });
            }

            function checkAnswer(selected, correct, targetPos) {
                const feedback = document.getElementById('quiz-feedback');
                const modal = document.getElementById('quiz-modal');

                if (selected === correct) {
                    feedback.innerText = "ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰";
                    feedback.className = "mt-4 h-6 text-lg font-bold text-green-500";

                    // ìˆ˜ì •ëœ ë¡œì§: ì •ë‹µ í‘œì‹œ í›„ ë¹ ë¥´ê²Œ ì°½ì„ ë‹«ê³  ì´ë™ì„ ë³´ì—¬ì¤Œ
                    setTimeout(() => {
                        modal.classList.add('hidden');
                        // ì°½ì´ ë‹«íˆìë§ˆì ì´ë™ ì‹œì‘
                        finishMove(targetPos);
                    }, 600);
                } else {
                    feedback.innerText = "í‹€ë ¸ì–´ìš”! ì›ë˜ ìë¦¬ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤. ğŸ˜¢";
                    feedback.className = "mt-4 h-6 text-lg font-bold text-red-500";

                    setTimeout(() => {
                        modal.classList.add('hidden');
                        endTurn();
                    }, 1500);
                }
            }

            function finishMove(pos) {
                const player = players[currentPlayerIndex];
                player.pos = pos;
                renderPlayerToken(player); // ì¦‰ì‹œ ì´ë™ ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘

                // ì• ë‹ˆë©”ì´ì…˜ ì‹œê°„(0.5s) + ì•½ê°„ì˜ ì—¬ìœ ë¥¼ ë‘” í›„ ë‹¤ìŒ ë¡œì§ ì²˜ë¦¬
                setTimeout(() => {
                    if (pos === boardSize) {
                        showWinner(player);
                        return;
                    }

                    if (jumps[pos]) {
                        const newPos = jumps[pos];
                        const isLadder = newPos > pos;

                        showEventPopup(isLadder);

                        setTimeout(() => {
                            player.pos = newPos;
                            renderPlayerToken(player);

                            // 2ì°¨ ì´ë™(ë±€/ì‚¬ë‹¤ë¦¬) í›„ í„´ ì¢…ë£Œ
                            setTimeout(() => {
                                endTurn();
                            }, 700);
                        }, 1500);
                    } else {
                        // ë±€/ì‚¬ë‹¤ë¦¬ ì—†ìœ¼ë©´ ë°”ë¡œ í„´ ì¢…ë£Œ
                        endTurn();
                    }
                }, 600);
            }

            function showEventPopup(isLadder) {
                const container = document.getElementById('popup-container');
                const popup = document.createElement('div');
                popup.className = `event-popup ${isLadder ? 'good' : 'bad'}`;

                popup.innerHTML = isLadder
                    ? `<div class="text-4xl mb-2">ğŸªœ</div><div class="text-xl font-bold">ì‚¬ë‹¤ë¦¬ ë°œê²¬!</div><div class="text-sm">ìœ„ë¡œ ì˜¬ë¼ê°‘ë‹ˆë‹¤!</div>`
                    : `<div class="text-4xl mb-2">ğŸ</div><div class="text-xl font-bold">ìœ¼ì•…! ë±€ì´ë‹¤!</div><div class="text-sm">ë¯¸ë„ëŸ¬ì ¸ ë‚´ë ¤ê°‘ë‹ˆë‹¤...</div>`;

                container.appendChild(popup);

                setTimeout(() => {
                    popup.style.opacity = '0';
                    setTimeout(() => popup.remove(), 300);
                }, 1200);
            }

            function endTurn() {
                updateStats();
                currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
                updateTurnDisplay();

                isMoving = false;
                const btn = document.getElementById('roll-btn');
                btn.disabled = false;
                btn.classList.remove('opacity-50');
            }

            function showWinner(player) {
                const modal = document.getElementById('winner-modal');
                document.getElementById('winner-name').innerText = `${player.name} ë‹˜ì´ ìŠ¹ë¦¬í–ˆìŠµë‹ˆë‹¤!`;
                modal.classList.remove('hidden');
            }
        </script>
    </div>
</body>

</html>