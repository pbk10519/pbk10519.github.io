<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§ì¶¤ë²• ê°¤ëŸ¬ê·¸ (Spelling Galaga)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../styles/style.css">
    <style>
        /* Page Specific Styles */

        #game-container {
            width: 90vw;
            max-width: 600px;
            background-color: #0d131f;
            border: 4px solid #3b82f6;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
            display: flex;
            flex-direction: column;
            padding: 10px;
        }

        canvas {
            background-color: #0a0a0a;
            display: block;
            border-radius: 8px;
        }

        #info-bar {
            background-color: #1f2937;
            padding: 8px 12px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .modal {
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        /* Custom styles for the player ship */
        .player-ship {
            fill: #3b82f6;
            filter: drop-shadow(0 0 5px rgba(59, 130, 246, 0.8));
        }

        /* Button styling */
        .quiz-button {
            transition: all 0.15s ease-in-out;
        }

        .quiz-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(59, 130, 246, 0.4);
        }

        /* === í•˜íŠ¸ ìƒëª… í‘œì‹œ ìŠ¤íƒ€ì¼ ë° ì• ë‹ˆë©”ì´ì…˜ === */
        .heart {
            font-size: 1.5rem;
            /* Larger heart icon */
            color: #ef4444;
            /* Tailwind red-500 */
            transition: opacity 0.3s, transform 0.3s;
            display: inline-block;
        }

        /* í•˜íŠ¸ ë°”ì‚¬ì‚­ ê¹¨ì§€ëŠ” ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes shatter {
            0% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }

            50% {
                transform: scale(1.5) rotate(10deg);
                opacity: 0.5;
            }

            100% {
                transform: scale(0) rotate(-45deg);
                opacity: 0;
            }
        }

        .broken-heart {
            animation: shatter 0.5s ease-out forwards;
        }

        /* ================================== */
    </style>
</head>

<body class="flex flex-col items-center">

    <!-- ë‚´ë¹„ê²Œì´ì…˜ ë©”ë‰´ -->
    <nav class="nav-container">
        <ul class="nav-menu">
            <li class="nav-item"><a href="../index.html" class="nav-link">ğŸ  í™ˆ</a></li>
            <li class="nav-item"><a href="seatingarrangement.html" class="nav-link">ìë¦¬ë°°ì¹˜</a></li>
            <li class="nav-item"><a href="role.html" class="nav-link">1ì¸ 1ì—­</a></li>
            <li class="nav-item"><a href="candy.html" class="nav-link">ìƒí’ˆ ë½‘ê¸°</a></li>
            <li class="nav-item"><a href="99.html" class="nav-link">êµ¬êµ¬ë‹¨</a></li>
            <li class="nav-item"><a href="alphabet.html" class="nav-link">ì•ŒíŒŒë²³</a></li>
            <li class="nav-item"><a href="spelling.html" class="nav-link active">ë§ì¶¤ë²•</a></li>
        </ul>
    </nav>

    <div class="page-container flex flex-col items-center justify-center">
        <div id="game-container">
            <!-- ê²Œì„ ì •ë³´ (ì ìˆ˜, ìƒëª…) -->
            <div id="info-bar" class="flex justify-between text-white font-bold text-lg">
                <div>ì ìˆ˜: <span id="score">0</span></div>
                <!-- ìƒëª… í‘œì‹œ: í…ìŠ¤íŠ¸ì—ì„œ í•˜íŠ¸ ì»¨í…Œì´ë„ˆë¡œ ë³€ê²½ -->
                <div class="flex items-center">
                    <span>ìƒëª…: </span>
                    <div id="lives-container" class="flex items-center space-x-1 ml-2">
                        <!-- í•˜íŠ¸ ì•„ì´ì½˜ì´ JSë¡œ ì—¬ê¸°ì— ë“¤ì–´ê°‘ë‹ˆë‹¤ -->
                    </div>
                </div>
            </div>

            <!-- ìº”ë²„ìŠ¤ ì˜ì—­ -->
            <canvas id="gameCanvas" width="600" height="700"></canvas>
        </div>

        <!-- 1. í€´ì¦ˆ ëª¨ë‹¬ -->
        <div id="quiz-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal p-4">
            <div
                class="bg-white rounded-xl shadow-2xl p-6 md:p-8 max-w-lg w-full text-center border-4 border-indigo-500">
                <h2 class="text-3xl font-extrabold text-indigo-700 mb-4">ğŸš¨ ë§ì¶¤ë²• í€´ì¦ˆ! ğŸš¨</h2>
                <p class="text-gray-600 mb-6 text-lg">ë‹¤ìŒ ë¬¸ì¥ ì¤‘ **ë§ëŠ” í‘œí˜„**ì„ ê³ ë¥´ì„¸ìš”.</p>

                <div id="quiz-question"
                    class="text-2xl font-bold text-gray-800 mb-8 p-4 bg-yellow-100 rounded-lg border border-yellow-300">
                    <!-- í€´ì¦ˆ ë‚´ìš© -->
                </div>

                <div id="quiz-options" class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <!-- ì˜µì…˜ ë²„íŠ¼ë“¤ì´ ì—¬ê¸°ì— ìƒì„±ë¨ -->
                </div>

                <div id="quiz-feedback" class="mt-6 h-6 text-xl font-bold"></div>
            </div>
        </div>

        <!-- 2. ê²Œì„ ì˜¤ë²„ ëª¨ë‹¬ -->
        <div id="gameover-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal p-4">
            <div class="bg-white rounded-xl shadow-2xl p-8 max-w-sm w-full text-center border-4 border-red-500">
                <div class="text-7xl mb-4">ğŸ’¥</div>
                <h2 class="text-4xl font-extrabold text-red-700 mb-2">ê²Œì„ ì˜¤ë²„!</h2>
                <p class="text-xl text-gray-600 mb-6">ìµœì¢… ì ìˆ˜: <span id="final-score"
                        class="font-bold text-red-500">0</span></p>
                <button onclick="startGame()"
                    class="w-full bg-indigo-500 text-white py-3 rounded-xl hover:bg-indigo-600 text-lg font-bold transition">
                    ë‹¤ì‹œ ì‹œì‘
                </button>
            </div>
        </div>

        <!-- 3. ì‹œì‘ ëª¨ë‹¬ -->
        <div id="start-modal" class="fixed inset-0 z-50 flex items-center justify-center modal p-4">
            <div class="bg-white rounded-xl shadow-2xl p-8 max-w-sm w-full text-center border-4 border-green-500">
                <h2 class="text-4xl font-extrabold text-green-700 mb-4">ğŸš€ ë§ì¶¤ë²• ê°¤ëŸ¬ê·¸</h2>
                <p class="text-gray-600 mb-6">ë–¨ì–´ì§€ëŠ” ë²½ëŒì„ íŒŒê´´í•˜ê³ , ë†“ì¹œ ë²½ëŒì€ í€´ì¦ˆë¡œ ìƒëª…ì„ ì§€í‚¤ì„¸ìš”!</p>

                <div class="text-left mb-6 text-sm space-y-2 p-3 bg-gray-100 rounded-lg">
                    <p>â€¢ ì´ë™: â—€ / â–¶ ë˜ëŠ” A / D</p>
                    <p>â€¢ ë°œì‚¬: Spacebar</p>
                    <!-- ìƒëª… ê°œìˆ˜ í‘œì‹œ ì œê±° -->
                </div>

                <button onclick="document.getElementById('start-modal').classList.add('hidden'); startGame();"
                    class="w-full bg-green-500 text-white py-3 rounded-xl hover:bg-green-600 text-lg font-bold transition">
                    ê²Œì„ ì‹œì‘!
                </button>
            </div>
        </div>

        <script>
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            const infoScore = document.getElementById('score');
            const quizModal = document.getElementById('quiz-modal');
            const gameoverModal = document.getElementById('gameover-modal');

            let gameState = {
                score: 0,
                lives: 5,
                player: null,
                bullets: [],
                bricks: [],
                keys: {},
                lastShotTime: 0,
                brickDropRate: 1500, // ms
                lastBrickTime: 0,
                gameLoopId: null,
                isPaused: true,
                currentQuiz: null
            };

            // --- 1. ë§ì¶¤ë²• í€´ì¦ˆ ë°ì´í„° ---
            const quizData = [
                { question: "ì–´ë–¤ ì¼ì„ í•  ë•Œ ë§ˆë•…íˆ ì§€ì¼œì•¼ í•  ë„ë¦¬ë‚˜ ìì„¸ëŠ”?", correct: "ë¡œì„œ", incorrect: "ë¡œì¨", sentence: "ì„ ìƒë‹˜ **( )** ëª¨ë²”ì„ ë³´ì—¬ì•¼ í•œë‹¤." },
                { question: "ì¼ì˜ ìˆ˜ë‹¨ì´ë‚˜ ë„êµ¬, ë˜ëŠ” ì‹œê°„ì„ ë‚˜íƒ€ë‚¼ ë•ŒëŠ”?", correct: "ë¡œì¨", incorrect: "ë¡œì„œ", sentence: "ì´ê²ƒì€ ë§ˆì§€ë§‰ **( )** ìµœí›„ í†µì²©ì´ë‹¤." },
                { question: "ì–´ì©ì§€ ë˜ëŠ” ë¬´ìŠ¨ ê¹Œë‹­ì¸ì§€ ëª¨ë¥´ê²ŒëŠ”?", correct: "ì™ ì§€", incorrect: "ì›¬ì§€", sentence: "**( )** ì˜¤ëŠ˜ì€ ìš´ì´ ì¢‹ì„ ê²ƒ ê°™ì•„." },
                { question: "ì–´ë– í•˜ê±°ë‚˜ ì–´ì°Œí•˜ë‹¤ì˜ ëœ»ì€?", correct: "ì›¬", incorrect: "ì™ ", sentence: "ì´ **( )** ì‚¬ëŒì´ ìš°ë¦¬ ì§‘ì— ì™”ì„ê¹Œ?" },
                { question: "í•´ë„ ë˜ë‹ˆ/ì•ˆ ë˜ë‹ˆ?", correct: "ë¼", incorrect: "ë˜", sentence: "ê·¸ë ‡ê²Œ í•˜ë©´ **( )** ì•ˆ ëœë‹¤." },
                { question: "ë¬´ì–¸ê°€ë¥¼ ì´ë£¨ì–´ ì¡Œì„ ë•Œ?", correct: "ëì–´", incorrect: "ë¬ì–´", sentence: "ì´ì œì•¼ ìˆ™ì œê°€ **( )**." },
                { question: "ë©°ì¹ ì´ ë§ì„ê¹Œ, ëª‡ì¼ì´ ë§ì„ê¹Œ?", correct: "ë©°ì¹ ", incorrect: "ëª‡ì¼", sentence: "ë°©í•™ì´ **( )** ë‚¨ì•˜ì§€?" },
                { question: "ì–´ë–¡í• ê¹Œ, ì–´ë–»í• ê¹Œ?", correct: "ì–´ë–¡í•´", incorrect: "ì–´ë–»í•´", sentence: "ì´ì œ ìš°ë¦¬ **( )**?" },
            ];

            // --- 2. ê²Œì„ ì—”í‹°í‹° í´ë˜ìŠ¤ (Player, Bullet, Brick ì½”ë“œëŠ” ë³€ê²½ ì—†ìŒ) ---

            // í”Œë ˆì´ì–´ (ë¹„í–‰ê¸°)
            class Player {
                constructor(x, y, width, height) {
                    this.width = width;
                    this.height = height;
                    this.x = x;
                    this.y = y;
                    this.speed = 8;
                }
                draw() {
                    // ì»¤ìŠ¤í…€ SVG ëª¨ì–‘ (ê°„ë‹¨í•œ ë¹„í–‰ê¸°)
                    ctx.fillStyle = '#3b82f6';
                    ctx.beginPath();
                    ctx.moveTo(this.x + this.width / 2, this.y); // ìƒë‹¨ ì¤‘ì•™
                    ctx.lineTo(this.x + this.width, this.y + this.height); // ìš°ì¸¡ í•˜ë‹¨
                    ctx.lineTo(this.x, this.y + this.height); // ì¢Œì¸¡ í•˜ë‹¨
                    ctx.closePath();
                    ctx.fill();
                }
                update() {
                    if (gameState.keys['ArrowLeft'] || gameState.keys['a']) {
                        this.x -= this.speed;
                    }
                    if (gameState.keys['ArrowRight'] || gameState.keys['d']) {
                        this.x += this.speed;
                    }
                    // ê²½ê³„ ì²´í¬
                    if (this.x < 0) this.x = 0;
                    if (this.x + this.width > canvas.width) this.x = canvas.width - this.width;
                }
                shoot() {
                    const now = Date.now();
                    if (now - gameState.lastShotTime > 200) { // 0.2ì´ˆ ë”œë ˆì´
                        gameState.bullets.push(new Bullet(this.x + this.width / 2, this.y));
                        gameState.lastShotTime = now;
                    }
                }
            }

            // ì´ì•Œ
            class Bullet {
                constructor(x, y) {
                    this.x = x;
                    this.y = y;
                    this.radius = 4;
                    this.speed = 10;
                    this.color = '#facc15'; // ë…¸ë€ìƒ‰
                }
                draw() {
                    ctx.fillStyle = this.color;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                    ctx.fill();
                }
                update() {
                    this.y -= this.speed;
                }
            }

            // ë²½ëŒ (í€´ì¦ˆ ë¸”ë¡)
            class Brick {
                constructor(x, y, width, height, word) {
                    this.x = x;
                    this.y = y;
                    this.width = width;
                    this.height = height;
                    this.word = word; // ë²½ëŒì— í‘œì‹œë  ê¸€ì (ë¬¸ì œ ë‹¨ì–´)
                    this.speed = 0.5 + Math.random() * 0.5; // ì†ë„ ëœë¤
                    this.color = '#dc2626'; // ë¹¨ê°„ìƒ‰
                }
                draw() {
                    ctx.fillStyle = this.color;
                    ctx.fillRect(this.x, this.y, this.width, this.height);

                    // í…ìŠ¤íŠ¸ í‘œì‹œ
                    ctx.fillStyle = 'white';
                    ctx.font = '18px Jua';
                    ctx.textAlign = 'center';
                    ctx.fillText(this.word, this.x + this.width / 2, this.y + this.height / 2 + 5);
                }
                update() {
                    this.y += this.speed;
                }
            }

            // --- 3. ê²Œì„ í•¨ìˆ˜ ---

            function initGame() {
                canvas.width = canvas.clientWidth;
                canvas.height = canvas.clientHeight;

                gameState.score = 0;
                gameState.lives = 5;
                gameState.isPaused = false;
                gameState.bricks = [];
                gameState.bullets = [];

                // í”Œë ˆì´ì–´ ì´ˆê¸°í™” (ìº”ë²„ìŠ¤ ì•„ë˜ìª½ ì¤‘ì•™)
                gameState.player = new Player(
                    canvas.width / 2 - 20,
                    canvas.height - 50,
                    40,
                    30
                );

                infoScore.textContent = gameState.score;
                renderHearts(); // í•˜íŠ¸ ë Œë”ë§ í•¨ìˆ˜ í˜¸ì¶œ
                gameoverModal.classList.add('hidden');
            }

            // í•˜íŠ¸ ì•„ì´ì½˜ì„ ë Œë”ë§í•˜ê³  ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
            function renderHearts() {
                const infoLivesContainer = document.getElementById('lives-container');
                infoLivesContainer.innerHTML = '';

                // ì´ˆê¸° ìƒëª… ê°œìˆ˜ë§Œí¼ í•˜íŠ¸ ìƒì„±
                for (let i = 0; i < gameState.lives; i++) {
                    const heart = document.createElement('span');
                    heart.className = 'heart';
                    heart.innerHTML = 'â¤ï¸'; // ìœ ë‹ˆì½”ë“œ í•˜íŠ¸ ì‹¬ë³¼
                    heart.dataset.lifeIndex = i; // 0ë¶€í„° ì‹œì‘í•˜ëŠ” ì¸ë±ìŠ¤
                    infoLivesContainer.appendChild(heart);
                }
            }

            function startGame() {
                if (gameState.gameLoopId) {
                    cancelAnimationFrame(gameState.gameLoopId);
                }
                initGame();
                gameLoop();
                attachEventListeners();
            }

            function gameLoop() {
                if (gameState.isPaused) return;

                update();
                draw();

                gameState.gameLoopId = requestAnimationFrame(gameLoop);
            }

            function update() {
                const now = Date.now();

                // A. í”Œë ˆì´ì–´ ì—…ë°ì´íŠ¸
                gameState.player.update();
                if (gameState.keys[' ']) {
                    gameState.player.shoot();
                }

                // B. ë²½ëŒ ìƒì„±
                if (now - gameState.lastBrickTime > gameState.brickDropRate) {
                    spawnBrick();
                    gameState.lastBrickTime = now;
                    // ë‚œì´ë„ ìƒìŠ¹ (ìµœëŒ€ 500msê¹Œì§€ ê°ì†Œ)
                    if (gameState.brickDropRate > 500) {
                        gameState.brickDropRate -= 20;
                    }
                }

                // C. ì´ì•Œ ì—…ë°ì´íŠ¸ ë° ê²½ê³„ í™•ì¸
                gameState.bullets.forEach(bullet => bullet.update());
                gameState.bullets = gameState.bullets.filter(bullet => bullet.y > 0);

                // D. ë²½ëŒ ì—…ë°ì´íŠ¸ ë° ë°”ë‹¥ ì¶©ëŒ í™•ì¸
                for (let i = gameState.bricks.length - 1; i >= 0; i--) {
                    const brick = gameState.bricks[i];
                    brick.update();

                    // ë°”ë‹¥ ì¶©ëŒ (í€´ì¦ˆ íŠ¸ë¦¬ê±°)
                    if (brick.y + brick.height > canvas.height) {
                        gameState.isPaused = true;
                        showQuiz(brick.word);
                        gameState.bricks.splice(i, 1); // ë²½ëŒì€ ì¼ë‹¨ ì œê±°
                        return; // í€´ì¦ˆê°€ ë‚˜ì˜¤ë©´ ë°”ë¡œ ë£¨í”„ ì •ì§€
                    }
                }

                // E. ì¶©ëŒ ê°ì§€ (ì´ì•Œ vs ë²½ëŒ)
                for (let i = gameState.bullets.length - 1; i >= 0; i--) {
                    const bullet = gameState.bullets[i];
                    for (let j = gameState.bricks.length - 1; j >= 0; j--) {
                        const brick = gameState.bricks[j];

                        if (checkCollision(bullet, brick)) {
                            // ì¶©ëŒ ë°œìƒ: ì´ì•Œ, ë²½ëŒ ì œê±° ë° ì ìˆ˜ ì¦ê°€
                            gameState.bullets.splice(i, 1);
                            gameState.bricks.splice(j, 1);
                            gameState.score += 10;
                            infoScore.textContent = gameState.score;
                            break; // ë‹¤ìŒ ì´ì•Œë¡œ ì´ë™
                        }
                    }
                }
            }

            function draw() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // ë²½ëŒ ê·¸ë¦¬ê¸°
                gameState.bricks.forEach(brick => brick.draw());

                // ì´ì•Œ ê·¸ë¦¬ê¸°
                gameState.bullets.forEach(bullet => bullet.draw());

                // í”Œë ˆì´ì–´ ê·¸ë¦¬ê¸°
                gameState.player.draw();
            }

            function spawnBrick() {
                const brickWidth = 80;
                const brickHeight = 30;

                // ëœë¤ ë¬¸ì œ ì„ íƒ
                const quizIndex = Math.floor(Math.random() * quizData.length);
                const quiz = quizData[quizIndex];
                const displayWord = Math.random() < 0.5 ? quiz.correct : quiz.incorrect; // ë²½ëŒì— í‘œì‹œë  ë‹¨ì–´

                const x = Math.random() * (canvas.width - brickWidth);
                const y = -brickHeight; // í™”ë©´ ë°– ìœ„ì—ì„œ ì‹œì‘

                gameState.bricks.push(new Brick(x, y, brickWidth, brickHeight, displayWord));
            }

            function checkCollision(bullet, brick) {
                // ê°„ë‹¨í•œ ì‚¬ê°í˜• ì¶©ëŒ ê°ì§€ (AABB)
                return (
                    bullet.x + bullet.radius > brick.x &&
                    bullet.x - bullet.radius < brick.x + brick.width &&
                    bullet.y + bullet.radius > brick.y &&
                    bullet.y - bullet.radius < brick.y + brick.height
                );
            }

            // --- 4. í€´ì¦ˆ ë° ìƒëª… ê´€ë¦¬ ---

            function showQuiz(word) {
                const quizContent = document.getElementById('quiz-question');
                const optionsContainer = document.getElementById('quiz-options');
                const feedback = document.getElementById('quiz-feedback');

                // Wall word is either the correct or incorrect form
                const selectedQuiz = quizData.find(q => q.correct === word || q.incorrect === word);

                if (!selectedQuiz) {
                    console.error("Quiz data not found for word:", word);
                    // ì˜¤ë¥˜ ë°œìƒ ì‹œ ìƒëª…ë§Œ 1 ê°ì†Œì‹œí‚¤ê³  ê²Œì„ ì¬ê°œ
                    loseLife();
                    return;
                }

                // í€´ì¦ˆ ë°ì´í„° ì„¤ì •
                const questionText = selectedQuiz.sentence.replace('**( )**', '____');
                quizContent.innerHTML = `${selectedQuiz.question}<br><span class="text-xl mt-2 block">${questionText}</span>`;
                feedback.textContent = '';
                optionsContainer.innerHTML = '';

                gameState.currentQuiz = selectedQuiz;

                // ì˜µì…˜ ì„¤ì •
                const options = [
                    { text: selectedQuiz.sentence.replace('**( )**', `**${selectedQuiz.correct}**`), isCorrect: true, word: selectedQuiz.correct },
                    { text: selectedQuiz.sentence.replace('**( )**', `**${selectedQuiz.incorrect}**`), isCorrect: false, word: selectedQuiz.incorrect }
                ];

                // ëœë¤í•˜ê²Œ ì„ê¸°
                options.sort(() => Math.random() - 0.5);

                options.forEach(option => {
                    const btn = document.createElement('button');
                    btn.className = "quiz-button bg-indigo-500 text-white font-semibold py-3 px-4 rounded-lg shadow-md hover:bg-indigo-600 transition";
                    btn.innerHTML = option.text;
                    btn.onclick = () => checkQuizAnswer(option.word, selectedQuiz.correct);
                    optionsContainer.appendChild(btn);
                });

                quizModal.classList.remove('hidden');
            }

            function checkQuizAnswer(selectedWord, correctWord) {
                const feedback = document.getElementById('quiz-feedback');
                const options = document.getElementById('quiz-options').querySelectorAll('button');

                // ë²„íŠ¼ ë¹„í™œì„±í™”
                options.forEach(btn => btn.disabled = true);

                if (selectedWord === correctWord) {
                    feedback.textContent = "ì •ë‹µì…ë‹ˆë‹¤! ğŸ¥³ ìƒëª… ìœ ì§€!";
                    feedback.className = "mt-6 h-6 text-xl font-bold text-green-500";
                    setTimeout(() => quizSolved(true), 1500);
                } else {
                    feedback.textContent = `í‹€ë ¸ìŠµë‹ˆë‹¤! ì •ë‹µì€ '${correctWord}' ì…ë‹ˆë‹¤. ğŸ˜¢ ìƒëª… -1`;
                    feedback.className = "mt-6 h-6 text-xl font-bold text-red-500";
                    setTimeout(() => quizSolved(false), 2500);
                }
            }

            function quizSolved(isCorrect) {
                quizModal.classList.add('hidden');
                gameState.isPaused = false;

                if (!isCorrect) {
                    loseLife();
                }

                // í€´ì¦ˆê°€ í’€ë¦° í›„ ê²Œì„ ë£¨í”„ ì¬ê°œ
                gameLoop();
            }

            function loseLife() {
                // 1. í•˜íŠ¸ ì• ë‹ˆë©”ì´ì…˜ ì ìš© (í˜„ì¬ ìƒëª…ì— í•´ë‹¹í•˜ëŠ” í•˜íŠ¸ë¥¼ ê¹¨ëœ¨ë¦¼)
                const livesContainer = document.getElementById('lives-container');
                const hearts = livesContainer.querySelectorAll('.heart');

                if (gameState.lives > 0) {
                    // í˜„ì¬ ìƒëª…ì´ 5ê°œë¼ë©´, ì¸ë±ìŠ¤ 4ë²ˆ í•˜íŠ¸(ë‹¤ì„¯ ë²ˆì§¸ í•˜íŠ¸)ë¥¼ ê¹¨ëœ¨ë¦¼
                    const heartIndexToBreak = gameState.lives - 1;

                    if (hearts[heartIndexToBreak]) {
                        hearts[heartIndexToBreak].classList.add('broken-heart');
                        // ì• ë‹ˆë©”ì´ì…˜ ì§€ì† ì‹œê°„ í›„ ì™„ì „íˆ ìˆ¨ê¹€ (optional: hearts[heartIndexToBreak].style.visibility = 'hidden';)
                    }
                }

                // 2. ìƒëª… ê°ì†Œ
                gameState.lives -= 1;

                if (gameState.lives <= 0) {
                    gameOver();
                }
            }

            function gameOver() {
                cancelAnimationFrame(gameState.gameLoopId);
                gameState.isPaused = true;
                document.getElementById('final-score').textContent = gameState.score;
                gameoverModal.classList.remove('hidden');
            }

            // --- 5. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---

            function attachEventListeners() {
                // í‚¤ ì…ë ¥ ì²˜ë¦¬
                document.removeEventListener('keydown', handleKeyDown);
                document.removeEventListener('keyup', handleKeyUp);
                document.addEventListener('keydown', handleKeyDown);
                document.addEventListener('keyup', handleKeyUp);

                // ìœˆë„ìš° ë¦¬ì‚¬ì´ì¦ˆ ì²˜ë¦¬ (ìº”ë²„ìŠ¤ í¬ê¸° ì¡°ì •)
                window.removeEventListener('resize', handleResize);
                window.addEventListener('resize', handleResize);
            }

            function handleKeyDown(e) {
                if (gameState.isPaused) return;
                // ìŠ¤í˜ì´ìŠ¤ë°”ë¥¼ ëˆ„ë¥¼ ë•Œ í˜ì´ì§€ ìŠ¤í¬ë¡¤ ë°©ì§€
                if (e.key === ' ') {
                    e.preventDefault();
                }
                gameState.keys[e.key] = true;
                gameState.keys[e.key.toLowerCase()] = true; // A/D í‚¤ ì§€ì›
            }

            function handleKeyUp(e) {
                delete gameState.keys[e.key];
                delete gameState.keys[e.key.toLowerCase()];
            }

            function handleResize() {
                const container = document.getElementById('game-container');
                // ì»¨í…Œì´ë„ˆ í¬ê¸°ì— ë§ì¶° ìº”ë²„ìŠ¤ í¬ê¸° ì¬ì„¤ì •
                canvas.width = container.clientWidth - 20; // íŒ¨ë”© ê³ ë ¤
                canvas.height = Math.min(canvas.width * 1.2, 700);

                // í”Œë ˆì´ì–´ ìœ„ì¹˜ ì¬ì¡°ì •
                if (gameState.player) {
                    gameState.player.y = canvas.height - 50;
                }

                // ê²Œì„ ë£¨í”„ê°€ ì‹¤í–‰ ì¤‘ì¼ ë•Œë§Œ draw í˜¸ì¶œ (í˜¹ì‹œ ëª¨ë¥¼ ì”ìƒ ì œê±°)
                if (!gameState.isPaused) {
                    draw();
                }
            }

            // ì´ˆê¸° ìº”ë²„ìŠ¤ í¬ê¸° ì„¤ì •
            window.onload = () => {
                handleResize();
            };

        </script>
    </div>
    </div>
</body>

</html>