<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìš°ë¦¬ ë°˜ 1ì¸ 1ì—­ ëœë¤ ë½‘ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="../styles/style.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Gamja+Flower&display=swap');

        /* Page specific */


        .notebook-paper {
            background-color: #fff;
            background-image: linear-gradient(#e1e1e1 1px, transparent 1px);
            background-size: 100% 1.5em;
            line-height: 1.5em;
            box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .chalkboard {
            background-color: #2d3436;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='4' height='4' viewBox='0 0 4 4'%3E%3Cpath fill='%239C92AC' fill-opacity='0.1' d='M1 3h1v1H1V3zm2-2h1v1H3V1z'%3E%3C/path%3E%3C/svg%3E");
            color: #fff;
            font-family: 'Gamja Flower', cursive;
            border: 8px solid #bcaaa4;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .hand-written-input {
            font-family: 'Gamja Flower', cursive;
            border: none;
            border-bottom: 2px dashed #a0aec0;
            background: transparent;
            text-align: center;
            font-size: 1.25rem;
            transition: all 0.2s;
        }

        .hand-written-input:focus {
            outline: none;
            border-bottom: 2px solid #4fd1c5;
            transform: scale(1.05);
        }

        .btn-primary {
            background-color: #ff6b6b;
            color: white;
            border-radius: 1rem;
            box-shadow: 0 4px 0 #c0392b;
            transition: all 0.1s;
        }

        .btn-primary:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #c0392b;
        }

        .btn-secondary {
            background-color: #48dbfb;
            color: white;
            border-radius: 1rem;
            box-shadow: 0 4px 0 #0abde3;
            transition: all 0.1s;
        }

        .btn-secondary:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #0abde3;
        }

        /* ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes shake {
            0% {
                transform: translate(1px, 1px) rotate(0deg);
            }

            10% {
                transform: translate(-1px, -2px) rotate(-1deg);
            }

            20% {
                transform: translate(-3px, 0px) rotate(1deg);
            }

            30% {
                transform: translate(3px, 2px) rotate(0deg);
            }

            40% {
                transform: translate(1px, -1px) rotate(1deg);
            }

            50% {
                transform: translate(-1px, 2px) rotate(-1deg);
            }

            60% {
                transform: translate(-3px, 1px) rotate(0deg);
            }

            70% {
                transform: translate(3px, 1px) rotate(-1deg);
            }

            80% {
                transform: translate(-1px, -1px) rotate(1deg);
            }

            90% {
                transform: translate(1px, 2px) rotate(0deg);
            }

            100% {
                transform: translate(1px, -2px) rotate(-1deg);
            }
        }

        .shake-element {
            animation: shake 0.5s;
            animation-iteration-count: infinite;
        }

        .pop-in {
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            opacity: 0;
            transform: scale(0.5);
        }

        @keyframes popIn {
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
    </style>
</head>

<body class="flex flex-col items-center">

    <!-- ë‚´ë¹„ê²Œì´ì…˜ ë©”ë‰´ -->
    <nav class="nav-container">
        <ul class="nav-menu">
            <li class="nav-item"><a href="../index.html" class="nav-link">ğŸ  í™ˆ</a></li>
            <li class="nav-item"><a href="seatingarrangement.html" class="nav-link">ìë¦¬ë°°ì¹˜</a></li>
            <li class="nav-item"><a href="role.html" class="nav-link active">1ì¸ 1ì—­</a></li>
            <li class="nav-item"><a href="candy.html" class="nav-link">ìƒí’ˆ ë½‘ê¸°</a></li>
            <li class="nav-item"><a href="99.html" class="nav-link">êµ¬êµ¬ë‹¨</a></li>
            <li class="nav-item"><a href="alphabet.html" class="nav-link">ì•ŒíŒŒë²³</a></li>
            <li class="nav-item"><a href="spelling.html" class="nav-link">ë§ì¶¤ë²•</a></li>
        </ul>
    </nav>

    <div class="page-container">

        <!-- í—¤ë” -->
        <header class="mb-10 text-center">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-800 mb-2 drop-shadow-md whitespace-nowrap">ğŸ« 1ì¸ 1ì—­ ëœë¤
                ë½‘ê¸°</h1>
            <p class="text-gray-500 text-lg whitespace-nowrap">ìš°ë¦¬ ë°˜ ì—­í• ì„ ê³µì •í•˜ê³  ì¬ë¯¸ìˆê²Œ ì •í•´ë³´ì„¸ìš”!</p>
        </header>

        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <main class="w-full max-w-4xl">

            <!-- STEP 1: ì¸ì› ì„¤ì • -->
            <section id="step-1" class="notebook-paper p-8 rounded-xl mb-8 transform rotate-1 mx-auto max-w-md">
                <h2 class="text-2xl font-bold text-gray-700 mb-6 text-center border-b-2 border-gray-200 pb-2">Step 1. í•™ìƒ
                    ìˆ˜ ì…ë ¥</h2>
                <div class="flex flex-col items-center gap-6">
                    <div class="flex items-center gap-4">
                        <button onclick="adjustCount(-1)"
                            class="w-10 h-10 rounded-full bg-gray-200 text-gray-600 font-bold hover:bg-gray-300">-</button>
                        <div class="relative">
                            <input type="number" id="student-count" value="5" min="2" max="50"
                                class="text-4xl w-24 text-center font-bold bg-transparent border-b-4 border-gray-400 focus:outline-none focus:border-blue-500">
                            <span class="text-xl text-gray-500 ml-2">ëª…</span>
                        </div>
                        <button onclick="adjustCount(1)"
                            class="w-10 h-10 rounded-full bg-gray-200 text-gray-600 font-bold hover:bg-gray-300">+</button>
                    </div>
                    <button onclick="goToStep2()" class="btn-primary w-full py-3 text-xl font-bold">ë‹¤ìŒ: ì—­í•  ì •í•˜ê¸°</button>
                </div>
            </section>

            <!-- STEP 2: ì´ë¦„ ë° ì—­í•  ì…ë ¥ -->
            <section id="step-2" class="hidden flex flex-col gap-6">
                <div
                    class="flex flex-col md:flex-row justify-between items-center bg-white p-4 rounded-xl shadow-sm border border-gray-200">
                    <div class="mb-2 md:mb-0">
                        <h2 class="text-xl font-bold text-gray-700">Step 2. ì´ë¦„ê³¼ ì—­í•  í™•ì¸</h2>
                        <p class="text-sm text-gray-500">ìë™ìœ¼ë¡œ ì±„ì›Œì§„ ë‚´ìš©ì„ ìˆ˜ì •í•  ìˆ˜ ìˆì–´ìš”.</p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="regenerateDefaults()"
                            class="bg-yellow-400 text-white px-4 py-2 rounded-lg font-bold shadow-sm hover:bg-yellow-500 transition">ğŸ”„
                            ë‚´ìš© ë‹¤ì‹œ ì„ê¸°</button>
                        <button onclick="startDraw()" class="btn-primary px-8 py-2 text-lg font-bold">ë½‘ê¸° ì‹œì‘! ğŸ²</button>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- ì´ë¦„ ëª©ë¡ -->
                    <div class="notebook-paper p-6 rounded-xl transform -rotate-1">
                        <h3 class="text-xl font-bold text-indigo-600 text-center mb-4">ğŸ‘¶ í•™ìƒ ì´ë¦„</h3>
                        <div id="name-list" class="space-y-2 max-h-[500px] overflow-y-auto pr-2 custom-scrollbar">
                            <!-- JSë¡œ ìƒì„±ë¨ -->
                        </div>
                    </div>

                    <!-- ì—­í•  ëª©ë¡ -->
                    <div class="notebook-paper p-6 rounded-xl transform rotate-1">
                        <h3 class="text-xl font-bold text-green-600 text-center mb-4">ğŸ§¹ í•™ê¸‰ ì—­í• </h3>
                        <div id="role-list" class="space-y-2 max-h-[500px] overflow-y-auto pr-2 custom-scrollbar">
                            <!-- JSë¡œ ìƒì„±ë¨ -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- STEP 3: ê²°ê³¼ í™”ë©´ (ì¹ íŒ) -->
            <section id="step-3" class="hidden">
                <div class="chalkboard p-6 md:p-10 rounded-xl relative min-h-[500px]">

                    <!-- ìƒë‹¨ ë²„íŠ¼ -->
                    <div class="absolute top-4 right-4 flex gap-2">
                        <button onclick="resetAll()"
                            class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 rounded text-sm">ì²˜ìŒìœ¼ë¡œ</button>
                        <button onclick="reDraw()"
                            class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm shadow">ë‹¤ì‹œ
                            ë½‘ê¸°</button>
                    </div>

                    <h2 class="text-3xl text-center text-yellow-300 mb-8 border-b border-gray-500 pb-4 tracking-wider">
                        ğŸ‰ 1ì¸ 1ì—­ ê²°ê³¼ ğŸ‰</h2>

                    <!-- ê¸´ì¥ê° ì¡°ì„± ì• ë‹ˆë©”ì´ì…˜ ì˜ì—­ -->
                    <div id="tension-container"
                        class="absolute inset-0 flex flex-col items-center justify-center bg-black/80 z-10 rounded-xl">
                        <div class="text-6xl mb-4 animate-bounce">ğŸ¥</div>
                        <div class="text-4xl text-white font-bold shake-element text-center leading-relaxed">
                            ë‘êµ¬ë‘êµ¬ë‘êµ¬...<br>
                            <span class="text-yellow-400 text-2xl mt-2 block">ëˆ„ê°€ ì–´ë–¤ ì—­í• ì„ ë§¡ê²Œ ë ê¹Œìš”?</span>
                        </div>
                    </div>

                    <!-- ê²°ê³¼ ê·¸ë¦¬ë“œ -->
                    <div id="result-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- ê²°ê³¼ ì¹´ë“œ ìƒì„± -->
                    </div>
                </div>
            </section>

        </main>

        <!-- ëª¨ë‹¬ (ì•Œë¦¼ìš©) -->
        <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
            <div class="bg-white p-6 rounded-xl shadow-xl text-center max-w-sm mx-4">
                <p id="modal-msg" class="text-lg font-bold mb-4 text-gray-700">ë©”ì‹œì§€</p>
                <button onclick="closeModal()"
                    class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 font-bold">í™•ì¸</button>
            </div>
        </div>

        <script>
            // --- ë°ì´í„° ---
            const defaultRoles = [
                "ì¹ íŒ ì§€ìš°ê°œ", "ìš°ìœ  ë‹¹ë²ˆ", "êµì‹¤ í™˜ê¸°", "ë¶ˆ ë„ê¸°", "ì¤„ ì„¸ìš°ê¸°",
                "ì„ ìƒë‹˜ ë•ê¸°", "ë¶„ë¦¬ìˆ˜ê±°", "ì±…ì¥ ì •ë¦¬", "ë³µë„ ì§€í‚´ì´", "ì—ë„ˆì§€ ì§€í‚´ì´",
                "ê¸‰ì‹ ë„ìš°ë¯¸", "í™”ë¶„ ë¬¼ì£¼ê¸°", "ì¤€ë¹„ë¬¼ ì±™ê¸°ê¸°", "ì²­ì†Œ ë°˜ì¥", "ì‹œê°„ ì•Œë¦¬ë¯¸",
                "ë°œí‘œ ë„ìš°ë¯¸", "ì¤€ë¹„ ì²´ì¡°", "ìŒì•… í‹€ê¸°", "ì°½ë¬¸ ë‹«ê¸°", "ì±…ìƒ ì¤„ ë§ì¶”ê¸°",
                "ê²Œì‹œíŒ ì •ë¦¬", "ì»´í“¨í„° ë„ê¸°", "ì»¤íŠ¼ ì¹˜ê¸°", "ìš°ì‚° ì •ë¦¬", "ë°”ë¥¸ë§ ì§€í‚´ì´"
            ];

            const lastNames = ['ê¹€', 'ì´', 'ë°•', 'ìµœ', 'ì •', 'ê°•', 'ì¡°', 'ìœ¤', 'ì¥', 'ì„', 'í•œ', 'ì˜¤'];
            const firstNames = ['ë¯¼ì¤€', 'ì„œì¤€', 'ë„ìœ¤', 'ì˜ˆì¤€', 'ì‹œìš°', 'í•˜ì¤€', 'ì§€í˜¸', 'ì§€í›„', 'ì¤€ìš°', 'ì„œì—°', 'ì„œìœ¤', 'ì§€ìš°', 'ì„œí˜„', 'í•˜ì€', 'ì§€ë¯¼', 'ë¯¼ì„œ', 'ì§€ìœ ', 'ìœ¤ì„œ', 'ì±„ì›'];

            let studentCount = 5;
            let inputNames = [];
            let inputRoles = [];
            let previousAssignments = {}; // { ì´ë¦„: ì—­í•  } ì €ì¥ (ì´ì „ ì—­í•  íšŒí”¼ìš©)

            // --- ìœ í‹¸ë¦¬í‹° ---
            function generateName() {
                return lastNames[Math.floor(Math.random() * lastNames.length)] +
                    firstNames[Math.floor(Math.random() * firstNames.length)];
            }

            function adjustCount(val) {
                const el = document.getElementById('student-count');
                let next = parseInt(el.value) + val;
                if (next >= 2 && next <= 50) {
                    el.value = next;
                }
            }

            function showAlert(msg) {
                document.getElementById('modal-msg').innerText = msg;
                document.getElementById('modal').classList.remove('hidden');
            }
            function closeModal() {
                document.getElementById('modal').classList.add('hidden');
            }

            function shuffle(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            // --- STEP 1 -> STEP 2 ---
            function goToStep2() {
                studentCount = parseInt(document.getElementById('student-count').value);
                if (!studentCount || studentCount < 2) {
                    showAlert("í•™ìƒ ìˆ˜ëŠ” ìµœì†Œ 2ëª… ì´ìƒì´ì–´ì•¼ í•´ìš”!");
                    return;
                }

                renderInputs();

                document.getElementById('step-1').classList.add('hidden');
                document.getElementById('step-2').classList.remove('hidden');
            }

            function renderInputs() {
                const nameList = document.getElementById('name-list');
                const roleList = document.getElementById('role-list');

                nameList.innerHTML = '';
                roleList.innerHTML = '';

                // 1. ì—­í•  ëª©ë¡ ì„ì–´ì„œ ì¤€ë¹„
                let shuffledRoles = [...defaultRoles];
                shuffle(shuffledRoles);

                // ë¶€ì¡±í•˜ë©´ 'íŠ¹ë³„ ì—­í•  N'ìœ¼ë¡œ ì±„ì›€
                while (shuffledRoles.length < studentCount) {
                    shuffledRoles.push(`íŠ¹ë³„ ì—­í•  ${shuffledRoles.length + 1}`);
                }

                for (let i = 0; i < studentCount; i++) {
                    // Name Input
                    const nameWrapper = document.createElement('div');
                    nameWrapper.className = 'flex items-center';
                    nameWrapper.innerHTML = `
                    <span class="w-8 text-gray-400 font-bold">${i + 1}.</span>
                    <input type="text" id="name-${i}" value="${generateName()}" class="hand-written-input w-full text-gray-700" placeholder="ì´ë¦„">
                `;
                    nameList.appendChild(nameWrapper);

                    // Role Input
                    const roleWrapper = document.createElement('div');
                    roleWrapper.className = 'flex items-center';
                    roleWrapper.innerHTML = `
                    <span class="w-8 text-gray-400 font-bold">${i + 1}.</span>
                    <input type="text" id="role-${i}" value="${shuffledRoles[i]}" class="hand-written-input w-full text-blue-600" placeholder="ì—­í• ">
                `;
                    roleList.appendChild(roleWrapper);
                }
            }

            function regenerateDefaults() {
                // í˜„ì¬ ì…ë ¥ëœ ê°’ë“¤ì„ ë‹¤ ì§€ìš°ê³  ìƒˆë¡œ ëœë¤ ìƒì„±
                if (confirm("ì…ë ¥ëœ ë‚´ìš©ì´ ì‚¬ë¼ì§€ê³  ìƒˆë¡œ ìƒì„±ë©ë‹ˆë‹¤. ì§„í–‰í• ê¹Œìš”?")) {
                    renderInputs();
                }
            }

            // --- STEP 2 -> STEP 3 (DRAW) ---
            function startDraw() {
                // ë°ì´í„° ìˆ˜ì§‘
                inputNames = [];
                inputRoles = [];

                for (let i = 0; i < studentCount; i++) {
                    const n = document.getElementById(`name-${i}`).value.trim();
                    const r = document.getElementById(`role-${i}`).value.trim();

                    if (!n || !r) {
                        showAlert(`${i + 1}ë²ˆì˜ ì´ë¦„ì´ë‚˜ ì—­í• ì´ ë¹„ì–´ìˆì–´ìš”!`);
                        return;
                    }
                    inputNames.push(n);
                    inputRoles.push(r);
                }

                document.getElementById('step-2').classList.add('hidden');
                document.getElementById('step-3').classList.remove('hidden');

                performDrawLogic();
            }

            function reDraw() {
                document.getElementById('tension-container').classList.remove('hidden');
                document.getElementById('result-grid').innerHTML = ''; // ì´ˆê¸°í™”
                performDrawLogic();
            }

            function performDrawLogic() {
                // ê¸´ì¥ê° ì—°ì¶œ (3ì´ˆ)
                const tensionDiv = document.getElementById('tension-container');

                // ì‹¤ì œ ë¡œì§: ì…”í”Œ
                // "ì´ì „ê³¼ ë‹¤ë¥¸ ì—­í• " ë¡œì§:
                // 1. ì´ë¦„ì„ ê¸°ì¤€ìœ¼ë¡œ ì„ì„ì§€, ì—­í• ì„ ê¸°ì¤€ìœ¼ë¡œ ì„ì„ì§€ ê²°ì • (ë³´í†µ ì—­í• ì„ ì„ì–´ì„œ ì´ë¦„ì— ë§¤ì¹­)
                // 2. ë§Œì•½ ì´ì „ ë°ì´í„°ê°€ ìˆë‹¤ë©´, ìµœëŒ€í•œ ê²¹ì¹˜ì§€ ì•Šê²Œ ì¬ì…”í”Œ ì‹œë„ (ì™„ì „ íšŒí”¼ëŠ” ë¶ˆê°€ëŠ¥í•  ìˆ˜ë„ ìˆìŒ)

                let finalPairs = [];
                let attempts = 0;
                let success = false;

                // ì´ë¦„ì€ ê³ ì • ìˆœì„œë¡œ ë‘ê³ , ì—­í• ì„ ì„ì–´ì„œ ë§¤ì¹­í•œë‹¤ê³  ê°€ì •
                // í˜¹ì€ ë‘˜ ë‹¤ ì„ì–´ë„ ë¨. ì—¬ê¸°ì„œëŠ” ì´ë¦„ ëª©ë¡ ìˆœì„œëŒ€ë¡œ ì—­í• ì„ ë°°ì •í•˜ëŠ” UIë¡œ ë³´ì—¬ì¤„ ì˜ˆì •

                let targetRoles = [...inputRoles];

                while (attempts < 50 && !success) {
                    shuffle(targetRoles);

                    // ê²€ì‚¬: ëª¨ë“  í•™ìƒì— ëŒ€í•´ ì´ì „ ì—­í• ê³¼ ê°™ì€ì§€ í™•ì¸
                    let collision = false;
                    // ì´ì „ ê¸°ë¡ì´ ì—†ìœ¼ë©´ collisionì€ í•­ìƒ false -> success
                    if (Object.keys(previousAssignments).length > 0) {
                        for (let i = 0; i < studentCount; i++) {
                            const name = inputNames[i];
                            const newRole = targetRoles[i];
                            if (previousAssignments[name] === newRole) {
                                collision = true;
                                break;
                            }
                        }
                    }

                    if (!collision) {
                        success = true;
                    }
                    attempts++;
                }

                // ë£¨í”„ê°€ ëë‚¬ëŠ”ë° successê°€ falseë¼ë©´(ìš´ ë‚˜ì¨ or ë¶ˆê°€ëŠ¥), ê·¸ëƒ¥ ë§ˆì§€ë§‰ ì…”í”Œ ìƒíƒœ ì‚¬ìš©

                // ê²°ê³¼ ì €ì¥ (ë‹¤ìŒ ë²ˆ íšŒí”¼ë¥¼ ìœ„í•´)
                previousAssignments = {};
                for (let i = 0; i < studentCount; i++) {
                    previousAssignments[inputNames[i]] = targetRoles[i];
                }

                // 3ì´ˆ í›„ ê²°ê³¼ ê³µê°œ
                setTimeout(() => {
                    tensionDiv.classList.add('hidden');
                    displayResults(inputNames, targetRoles);
                }, 3000);
            }

            function displayResults(names, roles) {
                const grid = document.getElementById('result-grid');
                grid.innerHTML = '';

                for (let i = 0; i < studentCount; i++) {
                    const card = document.createElement('div');
                    // í¬ìŠ¤íŠ¸ì‡ ëŠë‚Œì˜ ìŠ¤íƒ€ì¼
                    const colors = ['bg-yellow-100', 'bg-blue-100', 'bg-green-100', 'bg-pink-100'];
                    const colorClass = colors[i % colors.length];

                    card.className = `${colorClass} text-gray-800 p-4 rounded shadow-md transform hover:scale-105 transition pop-in flex flex-col items-center justify-center min-h-[120px]`;
                    card.style.animationDelay = `${i * 100}ms`; // ìˆœì°¨ ë“±ì¥

                    // í•€ ì´ë¯¸ì§€ íš¨ê³¼ (CSS)
                    const pin = document.createElement('div');
                    pin.className = 'w-3 h-3 rounded-full bg-red-500 absolute -top-1.5 shadow-sm border border-red-700';

                    card.innerHTML = `
                    <div class="w-full text-center border-b border-gray-300 pb-2 mb-2">
                        <span class="text-sm text-gray-500 font-bold">í•™ìƒ</span><br>
                        <span class="text-xl font-bold font-sans">${names[i]}</span>
                    </div>
                    <div class="text-3xl text-gray-400 mb-1">â¬‡</div>
                    <div class="w-full text-center">
                        <span class="text-sm text-gray-500 font-bold">ì—­í• </span><br>
                        <span class="text-2xl font-black text-indigo-700 leading-tight">${roles[i]}</span>
                    </div>
                `;
                    card.appendChild(pin);
                    grid.appendChild(card);
                }
            }

            function resetAll() {
                if (confirm("ì²˜ìŒ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ì‹œê² ìŠµë‹ˆê¹Œ? ëª¨ë“  ì„¤ì •ì´ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.")) {
                    location.reload();
                }
            }

        </script>
    </div>
</body>

</html>