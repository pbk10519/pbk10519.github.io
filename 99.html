<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>êµ¬êµ¬ë‹¨ í• ë¦¬ê°ˆë¦¬</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Inter í°íŠ¸ ì‚¬ìš© */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .btn-card {
            transition: all 0.1s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .btn-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        .btn-bell {
            transition: all 0.1s ease;
            animation: pulse-ring 2s infinite cubic-bezier(0.4, 0, 0.6, 1);
        }
        .btn-bell:active {
            transform: scale(0.95);
        }
        /* ì•Œë¦¼ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
        #message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            opacity: 0;
            transition: all 0.3s ease-in-out;
            z-index: 50;
        }
        .message-show {
            opacity: 1 !important;
            transform: translate(-50%, -50%) scale(1) !important;
        }

        /* í„´ í‘œì‹œ ì• ë‹ˆë©”ì´ì…˜ */
        .player-turn {
            border: 4px solid #f97316; /* Tailwind orange-600 */
            box-shadow: 0 0 15px rgba(249, 115, 22, 0.8);
            transform: scale(1.02);
        }

    </style>
</head>
<body class="bg-gray-100 p-4">

    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <div id="app-container" class="w-full max-w-4xl mx-auto bg-white p-8 rounded-2xl shadow-2xl">
        <h1 class="text-3xl font-extrabold text-center mb-10 text-gray-800">ğŸ êµ¬êµ¬ë‹¨ í• ë¦¬ê°ˆë¦¬ ğŸ›ï¸</h1>

        <!-- 1. ì„¤ì • í™”ë©´ -->
        <div id="setup-screen" class="space-y-6">
            <div class="p-6 bg-yellow-50 rounded-xl">
                <p class="text-lg font-semibold text-gray-700 mb-4">í”Œë ˆì´ì–´ ìˆ˜ ì„ íƒ:</p>
                <div class="flex space-x-4">
                    <button onclick="setPlayerCount(2)" id="btn-2-players" class="flex-1 py-3 px-6 text-xl font-bold bg-indigo-500 text-white rounded-xl hover:bg-indigo-600 transition duration-150 shadow-md">
                        2ëª…
                    </button>
                    <button onclick="setPlayerCount(3)" id="btn-3-players" class="flex-1 py-3 px-6 text-xl font-bold bg-indigo-500 text-white rounded-xl hover:bg-indigo-600 transition duration-150 shadow-md">
                        3ëª…
                    </button>
                </div>
            </div>

            <div id="name-input-container" class="space-y-4 p-6 bg-white rounded-xl border border-gray-200 hidden">
                <p class="text-lg font-semibold text-gray-700">í”Œë ˆì´ì–´ ì´ë¦„ ì…ë ¥:</p>
                <div id="player-inputs" class="space-y-3">
                    <!-- ì´ë¦„ ì…ë ¥ í•„ë“œê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤. -->
                </div>
                <button onclick="startGame()" id="start-game-btn" class="w-full py-3 text-xl font-bold bg-green-500 text-white rounded-xl hover:bg-green-600 transition duration-150 shadow-lg mt-6">
                    ê²Œì„ ì‹œì‘!
                </button>
            </div>
        </div>

        <!-- 2. ê²Œì„ í™”ë©´ (ì²˜ìŒì—ëŠ” ìˆ¨ê¹€) -->
        <div id="game-screen" class="hidden">

            <!-- ê²Œì„ ìƒíƒœ ìš”ì•½ (ì¢…ë¥˜ë³„ ê³¼ì¼ í•©ê³„) -->
            <div class="text-center mb-8 p-4 bg-gray-50 rounded-xl shadow-inner">
                <p class="text-xl font-bold text-gray-700">í…Œì´ë¸” ìœ„ ê³¼ì¼ ì¢…ë¥˜ë³„ í•©ê³„:</p>
                <div id="fruit-counts-display" class="flex justify-center space-x-6 my-2 text-2xl font-extrabold text-red-600">
                    <!-- Dynamic fruit counts will go here -->
                </div>
                <p class="text-sm text-gray-500 mt-2">ê°™ì€ ì¢…ë¥˜ì˜ ê³¼ì¼ì´ <span class="font-bold text-red-600">5ê°œ</span>ê°€ ë˜ë©´ ì¢…ì„ ì¹  ìˆ˜ ìˆìŠµë‹ˆë‹¤!</p>
                <p id="turn-indicator" class="mt-4 text-lg font-bold text-indigo-600"></p>
            </div>

            <!-- í”Œë ˆì´ì–´ ì¹´ë“œ ë° ë²„íŠ¼ -->
            <div id="player-game-board" class="grid gap-6" style="grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));">
                <!-- í”Œë ˆì´ì–´ ì»´í¬ë„ŒíŠ¸ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤. -->
            </div>

            <!-- ë¦¬ì…‹/ì¢…ë£Œ ë²„íŠ¼ -->
            <div class="mt-10 flex justify-center space-x-4">
                <button onclick="resetGame()" class="py-3 px-6 bg-red-500 text-white font-bold rounded-xl hover:bg-red-600 transition shadow-md">
                    ê²Œì„ ì´ˆê¸°í™”
                </button>
            </div>
        </div>

        <!-- ë©”ì‹œì§€/ëª¨ë‹¬ ë°•ìŠ¤ (êµ¬êµ¬ë‹¨ ë¬¸ì œ ë“±) -->
        <div id="message-box" class="message-show hidden">
            <div class="bg-white p-8 rounded-2xl shadow-2xl border-4 border-indigo-500 w-96 text-center space-y-4">
                <div id="message-content">
                    <p class="text-2xl font-extrabold text-gray-800" id="message-title"></p>
                    <p class="text-xl text-gray-600" id="message-body"></p>
                </div>
                <input type="number" id="answer-input" class="w-full p-3 border-2 border-indigo-300 rounded-lg text-center text-2xl font-bold focus:outline-none focus:ring-2 focus:ring-indigo-500 hidden" placeholder="ì •ë‹µ ì…ë ¥">
                <button id="message-ok-btn" class="w-full py-3 bg-indigo-500 text-white font-bold rounded-xl hover:bg-indigo-600 transition shadow-md" onclick="handleMessageOk()">í™•ì¸</button>
            </div>
        </div>

        <!-- ë°°ê²½ ì˜¤ë²„ë ˆì´ -->
        <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden" onclick="closeMessage()"></div>

    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let playerCount = 0;
        let players = [];
        let currentPlayerIndex = 0;
        let currentProblem = null;
        let ringingPlayerIndex = -1;

        const FRUITS = ["ğŸ", "ğŸŒ", "ğŸ‡", "ğŸ“", "ğŸ‰"];

        // ìƒˆë¡œìš´ ë³€ìˆ˜: í…Œì´ë¸” ìœ„ ê³¼ì¼ ì¢…ë¥˜ë³„ ì´ ê°œìˆ˜
        let tableFruitCounts = {};

        function initializeTableFruitCounts() {
            tableFruitCounts = {};
            FRUITS.forEach(fruit => {
                tableFruitCounts[fruit] = 0;
            });
        }
        // ì´ˆê¸°í™” í•¨ìˆ˜ í˜¸ì¶œ
        initializeTableFruitCounts();

        // Firebase-like custom alert function
        function showMessage(title, body, isQuestion = false, callback = null) {
            const box = document.getElementById('message-box');
            const overlay = document.getElementById('overlay');
            const titleEl = document.getElementById('message-title');
            const bodyEl = document.getElementById('message-body');
            const answerInput = document.getElementById('answer-input');
            const okBtn = document.getElementById('message-ok-btn');

            titleEl.textContent = title;
            bodyEl.textContent = body;
            box.classList.remove('hidden');
            overlay.classList.remove('hidden');

            if (isQuestion) {
                answerInput.value = '';
                answerInput.classList.remove('hidden');
                okBtn.textContent = 'ì œì¶œ';
                // Enter í‚¤ë¡œ ì œì¶œ ê°€ëŠ¥í•˜ê²Œ ì„¤ì •
                answerInput.onkeydown = (event) => {
                    if (event.key === 'Enter') {
                        handleMessageOk();
                    }
                };
            } else {
                answerInput.classList.add('hidden');
                okBtn.textContent = 'í™•ì¸';
                answerInput.onkeydown = null;
            }

            // ì½œë°± í•¨ìˆ˜ ì €ì¥
            window.messageCallback = callback;

            // ì• ë‹ˆë©”ì´ì…˜ ì ìš©
            setTimeout(() => box.classList.add('message-show'), 10);
        }

        function closeMessage() {
            const box = document.getElementById('message-box');
            const overlay = document.getElementById('overlay');
            box.classList.remove('message-show');
            setTimeout(() => {
                box.classList.add('hidden');
                overlay.classList.add('hidden');
            }, 300); // ì• ë‹ˆë©”ì´ì…˜ ì‹œê°„ê³¼ ì¼ì¹˜
            document.getElementById('answer-input').onkeydown = null;
        }

        function handleMessageOk() {
            const answerInput = document.getElementById('answer-input');
            const answer = answerInput.value;
            closeMessage();

            if (window.messageCallback) {
                if (answerInput.classList.contains('hidden')) {
                    // ì¼ë°˜ í™•ì¸ ë²„íŠ¼ í´ë¦­
                    window.messageCallback(true);
                } else {
                    // ë¬¸ì œ ì œì¶œ ë²„íŠ¼ í´ë¦­
                    window.messageCallback(answer);
                }
            }
        }

        // 1. ì„¤ì • í™”ë©´ ë¡œì§
        function setPlayerCount(count) {
            playerCount = count;
            document.getElementById('btn-2-players').classList.remove('bg-indigo-700');
            document.getElementById('btn-3-players').classList.remove('bg-indigo-700');
            document.getElementById('btn-' + count + '-players').classList.add('bg-indigo-700');

            const inputContainer = document.getElementById('player-inputs');
            inputContainer.innerHTML = '';
            for (let i = 0; i < count; i++) {
                inputContainer.innerHTML += `
                    <input type="text" id="player-name-${i}" placeholder="í”Œë ˆì´ì–´ ${i + 1} ì´ë¦„" value="í”Œë ˆì´ì–´ ${i + 1}"
                           class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                `;
            }
            document.getElementById('name-input-container').classList.remove('hidden');
        }

        function startGame() {
            if (playerCount === 0) {
                showMessage("ì˜¤ë¥˜", "ë¨¼ì € í”Œë ˆì´ì–´ ìˆ˜ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.", false);
                return;
            }

            players = [];
            // allNamesValid í”Œë˜ê·¸ëŠ” ì´ë¦„ì´ ë¹„ì–´ìˆì§€ ì•Šì€ì§€ ê²€ì‚¬í•˜ëŠ” ìš©ë„ì˜€ìœ¼ë‚˜, ê¸°ë³¸ê°’ìœ¼ë¡œ ëŒ€ì²´í•˜ë¯€ë¡œ í•­ìƒ true
            let allNamesValid = true;

            for (let i = 0; i < playerCount; i++) {
                const nameInput = document.getElementById(`player-name-${i}`);
                let name = nameInput.value.trim();
                if (name === "") {
                    name = `í”Œë ˆì´ì–´ ${i + 1}`; // ì´ë¦„ì´ ì—†ìœ¼ë©´ ê¸°ë³¸ ì´ë¦„ ì‚¬ìš©
                }
                // í”Œë ˆì´ì–´ ì¹´ë“œ ì´ˆê¸° ìƒíƒœ: 0ê°œ, ì²« ë²ˆì§¸ ê³¼ì¼ë¡œ ì´ˆê¸°í™”
                players.push({ name: name, score: 0, currentFruitCount: 0, lastFruitEmoji: FRUITS[0] });
            }

            if (!allNamesValid) {
                // ì´ ë¶€ë¶„ì€ ì´ë¦„ ê¸°ë³¸ê°’ ì„¤ì •ìœ¼ë¡œ ì¸í•´ ì‚¬ì‹¤ìƒ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ
                showMessage("ì˜¤ë¥˜", "ëª¨ë“  í”Œë ˆì´ì–´ì˜ ì´ë¦„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.", false);
                return;
            }

            // í™”ë©´ ì „í™˜
            document.getElementById('setup-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');

            // í…Œì´ë¸” ê³¼ì¼ ì¹´ìš´íŠ¸ ì´ˆê¸°í™”
            initializeTableFruitCounts();

            renderGameBoard();
            updateGameDisplay();
        }

        // 2. ê²Œì„ í™”ë©´ ë¡œì§

        function renderGameBoard() {
            const board = document.getElementById('player-game-board');
            board.innerHTML = '';
            board.style.gridTemplateColumns = `repeat(auto-fit, minmax(280px, 1fr))`;

            players.forEach((player, index) => {
                const playerDiv = document.createElement('div');
                playerDiv.id = `player-card-${index}`;
                playerDiv.className = `player-card bg-white p-6 rounded-2xl shadow-xl space-y-4 transition duration-300 ease-in-out border-4 border-transparent`;
                playerDiv.innerHTML = `
                    <div class="flex justify-between items-center border-b pb-3 mb-3">
                        <h2 class="text-2xl font-bold text-gray-900">${player.name}</h2>
                        <span id="score-${index}" class="text-3xl font-extrabold text-indigo-600">${player.score}ì </span>
                    </div>

                    <!-- ì¹´ë“œ ë””ìŠ¤í”Œë ˆì´ -->
                    <div id="card-display-${index}" class="flex justify-center items-center h-32 bg-gray-200 rounded-xl text-5xl font-extrabold transition duration-300">
                        â“
                    </div>

                    <!-- ë²„íŠ¼ ì•¡ì…˜ -->
                    <div class="flex space-x-2">
                        <button onclick="flipCard(${index})" id="flip-btn-${index}" class="btn-card flex-1 py-3 bg-blue-500 text-white font-bold rounded-xl hover:bg-blue-600">
                            ì¹´ë“œ ë’¤ì§‘ê¸°
                        </button>
                        <button onclick="ringBell(${index})" class="btn-bell w-1/3 py-3 bg-yellow-400 text-gray-900 font-bold rounded-xl hover:bg-yellow-500">
                            ğŸ›ï¸ ì¢… ì¹˜ê¸°
                        </button>
                    </div>
                `;
                board.appendChild(playerDiv);
            });
        }

        function updateGameDisplay() {
            // 1. í”Œë ˆì´ì–´ë³„ ì ìˆ˜ ë° ì¹´ë“œ ì—…ë°ì´íŠ¸
            players.forEach((player, index) => {
                document.getElementById(`score-${index}`).textContent = `${player.score}ì `;
                const cardDisplay = document.getElementById(`card-display-${index}`);
                cardDisplay.innerHTML = player.currentFruitCount === 0
                    ? 'â“'
                    : `<span class="text-7xl">${player.lastFruitEmoji}</span><span class="text-4xl ml-2 font-bold">x${player.currentFruitCount}</span>`;
            });

            // 2. ê³¼ì¼ ì¢…ë¥˜ë³„ í•©ê³„ ì—…ë°ì´íŠ¸
            const fruitCountsDisplay = document.getElementById('fruit-counts-display');
            fruitCountsDisplay.innerHTML = '';
            
            FRUITS.forEach(fruit => {
                const count = tableFruitCounts[fruit] || 0;
                // 5ê°œì¼ ê²½ìš° ëˆˆì— ë„ê²Œ í‘œì‹œ
                fruitCountsDisplay.innerHTML += `
                    <div class="flex flex-col items-center">
                        <span class="text-4xl">${fruit}</span>
                        <span class="text-3xl ${count === 5 ? 'text-green-600 font-extrabold transform scale-110' : 'text-gray-800'}">${count}</span>
                    </div>
                `;
            });

            // 3. í„´ í‘œì‹œ ì—…ë°ì´íŠ¸
            const turnIndicator = document.getElementById('turn-indicator');
            const turnPlayer = players[currentPlayerIndex];
            turnIndicator.textContent = `í˜„ì¬ í„´: ${turnPlayer.name}ë‹˜ì´ ì¹´ë“œë¥¼ ë’¤ì§‘ì„ ì°¨ë¡€ì…ë‹ˆë‹¤.`;

            // 4. ì¹´ë“œ ë°°ê²½ í•˜ì´ë¼ì´íŠ¸ (í„´ í‘œì‹œ)
            players.forEach((player, index) => {
                const playerCard = document.getElementById(`player-card-${index}`);
                playerCard.classList.remove('player-turn');
                if (index === currentPlayerIndex) {
                    playerCard.classList.add('player-turn');
                }
            });
        }

        function flipCard(playerIndex) {
            if (playerIndex !== currentPlayerIndex) {
                showMessage("ì ê¹!", `${players[playerIndex].name}ë‹˜, ì§€ê¸ˆì€ ${players[currentPlayerIndex].name}ë‹˜ì˜ ì°¨ë¡€ì…ë‹ˆë‹¤.`, false);
                return;
            }

            const player = players[playerIndex];

            // 1. ì´ì „ ì¹´ë“œ ê°’ ì œê±°: í…Œì´ë¸” ì´ í•©ê³„ì—ì„œ ì´ì „ ê³¼ì¼ ìˆ˜ë¥¼ ëºŒ
            const oldFruit = player.lastFruitEmoji;
            const oldCount = player.currentFruitCount;
            if (oldCount > 0 && tableFruitCounts[oldFruit] !== undefined) {
                tableFruitCounts[oldFruit] -= oldCount;
            }

            // 2. ìƒˆë¡œìš´ ì¹´ë“œ ì •ë³´ ìƒì„± (1~5ê°œ)
            const newCount = Math.floor(Math.random() * 5) + 1;
            const fruitEmoji = FRUITS[Math.floor(Math.random() * FRUITS.length)];

            // 3. í”Œë ˆì´ì–´ ìƒíƒœ ì—…ë°ì´íŠ¸ (ìƒˆ ê°’ ì €ì¥)
            player.currentFruitCount = newCount;
            player.lastFruitEmoji = fruitEmoji;

            // 4. ìƒˆë¡œìš´ ì¹´ë“œ ê°’ ì¶”ê°€: í…Œì´ë¸” ì´ í•©ê³„ì— ìƒˆ ê³¼ì¼ ìˆ˜ë¥¼ ë”í•¨
            if (tableFruitCounts[fruitEmoji] !== undefined) {
                tableFruitCounts[fruitEmoji] += newCount;
            }


            // 5. ë‹¤ìŒ í„´ìœ¼ë¡œ ë„˜ê¸°ê¸°
            currentPlayerIndex = (currentPlayerIndex + 1) % playerCount;

            // 6. í™”ë©´ ì—…ë°ì´íŠ¸
            updateGameDisplay();
        }

        function ringBell(playerIndex) {
            ringingPlayerIndex = playerIndex; // ì¢…ì„ ì¹œ ì‚¬ëŒ ì €ì¥

            // 5ê°œê°€ ìˆëŠ”ì§€ í™•ì¸: tableFruitCountsì˜ ê°’ ì¤‘ 5ê°€ ìˆëŠ”ì§€ í™•ì¸
            const isFiveFruit = Object.values(tableFruitCounts).some(count => count === 5);

            if (isFiveFruit) {
                // ì¢… ì¹˜ê¸° ì„±ê³µ! êµ¬êµ¬ë‹¨ ë¬¸ì œ ì¶œì œ
                generateMultiplicationProblem();
            } else {
                // ì¢… ì¹˜ê¸° ì‹¤íŒ¨!
                handleFalseRing();
            }
        }

        function generateMultiplicationProblem() {
            // 2ë‹¨ë¶€í„° 9ë‹¨ê¹Œì§€, ê³±í•˜ëŠ” ìˆ˜ëŠ” 1ë¶€í„° 9ê¹Œì§€
            const num1 = Math.floor(Math.random() * 8) + 2; // 2 ~ 9
            const num2 = Math.floor(Math.random() * 9) + 1; // 1 ~ 9
            const correctAnswer = num1 * num2;

            currentProblem = { num1, num2, correctAnswer };

            showMessage(
                `${players[ringingPlayerIndex].name}ë‹˜, êµ¬êµ¬ë‹¨ ë¬¸ì œ!`,
                `${num1} X ${num2} = ?`,
                true, // ì§ˆë¬¸ ëª¨ë“œ í™œì„±í™”
                handleMultiplicationAnswer // ì½œë°± í•¨ìˆ˜
            );
        }

        function handleMultiplicationAnswer(answer) {
            const parsedAnswer = parseInt(answer);
            const player = players[ringingPlayerIndex];

            if (isNaN(parsedAnswer)) {
                showMessage("ì˜¤ë¥˜", "ìˆ«ìë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”! ë¬¸ì œë¥¼ í‹€ë ¸ìŠµë‹ˆë‹¤.", false, () => resetTable(false, player.name));
            } else if (parsedAnswer === currentProblem.correctAnswer) {
                // ì •ë‹µ!
                player.score++;
                // ë“ì  ì¦‰ì‹œ UIì— ë°˜ì˜
                updateGameDisplay(); 
                showMessage("ğŸ‰ ì •ë‹µ!", `${currentProblem.num1} X ${currentProblem.num2} = ${currentProblem.correctAnswer} (ì •ë‹µì…ë‹ˆë‹¤!)`, false, () => resetTable(true, player.name));
            } else {
                // ì˜¤ë‹µ!
                showMessage("âŒ ì˜¤ë‹µ!", `${currentProblem.num1} X ${currentProblem.num2} = ${currentProblem.correctAnswer} (ì •ë‹µì€ ${currentProblem.correctAnswer}ì…ë‹ˆë‹¤.)`, false, () => resetTable(false, player.name));
            }

            ringingPlayerIndex = -1; // ë¦¬ì…‹
        }

        function handleFalseRing() {
            const player = players[ringingPlayerIndex];

            // í˜„ì¬ ê³¼ì¼ ì¢…ë¥˜ë³„ í•©ê³„ë¥¼ ë³´ì—¬ì¤Œ
            let currentCounts = FRUITS.map(f => `${f}: ${tableFruitCounts[f]}`).join(', ');

            showMessage("ğŸš¨ ì˜¤ì¢…!", `í…Œì´ë¸” ìœ„ ê³¼ì¼ ì¤‘ 5ê°œì¸ ì¢…ë¥˜ê°€ ì—†ìŠµë‹ˆë‹¤. (í˜„ì¬ í•©ê³„: ${currentCounts})`, false, () => resetTable(false, player.name));

            ringingPlayerIndex = -1; // ë¦¬ì…‹
        }

        function resetTable(isCorrect, playerName) {
            // í…Œì´ë¸”ì˜ ëª¨ë“  ì¹´ë“œ ë¦¬ì…‹ (ì ìˆ˜ íšë“/ì‹¤íŒ¨ì™€ ê´€ê³„ì—†ì´ ì´ˆê¸°í™”)
            players.forEach(player => {
                player.currentFruitCount = 0;
            });

            // í…Œì´ë¸” ìœ„ ê³¼ì¼ ì¢…ë¥˜ë³„ ì´ ê°œìˆ˜ë¥¼ 0ìœ¼ë¡œ ë¦¬ì…‹
            initializeTableFruitCounts();

            // ëˆ„ê°€ ë‹¤ìŒ í„´ì„ ì‹œì‘í• ì§€ ê²°ì •
            if (isCorrect) {
                 // ë“ì ìê°€ ë‹¤ìŒ í„´ì„ ì‹œì‘í•˜ë„ë¡ currentPlayerIndexë¥¼ ê°±ì‹ 
                 currentPlayerIndex = players.findIndex(p => p.name === playerName);
            } else {
                // ì‹¤íŒ¨ ì‹œ: ì¢… ì¹œ ì‚¬ëŒì˜ ë‹¤ìŒ ì‚¬ëŒì´ ì‹œì‘
                currentPlayerIndex = (players.findIndex(p => p.name === playerName) + 1) % playerCount;
            }

            updateGameDisplay();
        }

        function resetGame() {
            const confirmReset = () => {
                playerCount = 0;
                players = [];
                // tableFruitCountsë„ ì´ˆê¸°í™”
                initializeTableFruitCounts();
                currentPlayerIndex = 0;
                currentProblem = null;
                ringingPlayerIndex = -1;

                document.getElementById('setup-screen').classList.remove('hidden');
                document.getElementById('game-screen').classList.add('hidden');
                document.getElementById('name-input-container').classList.add('hidden');
                document.getElementById('player-inputs').innerHTML = '';
                document.getElementById('player-game-board').innerHTML = '';

                // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
                document.getElementById('btn-2-players').classList.remove('bg-indigo-700');
                document.getElementById('btn-3-players').classList.remove('bg-indigo-700');
            };

            showMessage("ê²Œì„ ì´ˆê¸°í™”", "ì •ë§ë¡œ ê²Œì„ì„ ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?", false, confirmReset);
        }

        // ì´ˆê¸° í™”ë©´ ì„¤ì • (2ëª… ê¸°ë³¸ ì„ íƒ)
        window.onload = () => {
            setPlayerCount(2);
        };
    </script>
</body>
</html>
