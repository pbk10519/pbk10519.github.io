<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‘ê·¼ë‘ê·¼ ìƒí’ˆ ë½‘ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- íš¨ê³¼ìŒì„ ìœ„í•œ Tone.js ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Jua&display=swap');

        body {
            font-family: 'Jua', sans-serif;
            background-color: #ffeaa7; /* ë°ì€ ë…¸ë€ìƒ‰ ë°°ê²½ */
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .gacha-card {
            background-color: #f7f1e3; /* ë…¸íŠ¸/ì¹´ë“œ ìƒ‰ìƒ */
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border: 5px solid #ff7979; /* ê·€ì—¬ìš´ í…Œë‘ë¦¬ */
        }

        /* ë©”ì¸ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .gacha-button {
            position: relative;
            background-color: #eb4d4b; /* ë ˆë“œ */
            color: white;
            border: 5px solid #c23616; /* ë”¥ ë ˆë“œ í…Œë‘ë¦¬ */
            border-radius: 9999px; /* ì›í˜• */
            box-shadow: 0 10px 0 #c23616;
            transition: all 0.1s ease;
            cursor: pointer;
            width: 200px;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            z-index: 10;
        }

        .gacha-button:hover {
            background-color: #fa8231; /* ì˜¤ë Œì§€ */
        }

        .gacha-button:active {
            transform: translateY(10px);
            box-shadow: 0 0 0 #c23616;
        }

        /* ë²„íŠ¼ ì£¼ë³€ì˜ ìºë¦­í„° ì¥ì‹ */
        .deco-wrapper {
            position: relative;
            width: 200px;
            height: 200px;
        }
        .deco-wrapper > div {
            position: absolute;
            font-size: 2rem;
            animation: bounce-deco 4s infinite ease-in-out;
        }
        .deco-1 { top: -20px; left: -30px; transform: rotate(-15deg); animation-delay: 0s; }
        .deco-2 { top: 180px; left: -20px; transform: rotate(10deg); animation-delay: -1s; }
        .deco-3 { top: -30px; right: -40px; transform: rotate(5deg); animation-delay: -2s; }
        .deco-4 { top: 170px; right: -30px; transform: rotate(-10deg); animation-delay: -3s; }

        @keyframes bounce-deco {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* ê²°ê³¼ ì°½ ìŠ¤íƒ€ì¼ */
        .result-box {
            background-color: #fff;
            border: 4px dashed #6ab04c;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.5s;
        }
        
        /* ì…”í”Œ ì• ë‹ˆë©”ì´ì…˜ */
        .shuffle {
            animation: shuffle 0.05s infinite;
        }
        @keyframes shuffle {
            0%, 100% { transform: translateY(0) rotate(0); }
            50% { transform: translateY(-2px) rotate(1deg); }
        }

        /* ìµœì¢… ê²°ê³¼ íŒ ì• ë‹ˆë©”ì´ì…˜ */
        .pop-result {
            animation: popResult 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
        @keyframes popResult {
            0% { opacity: 0; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1); }
        }

    </style>
</head>
<body>

    <main class="w-full max-w-lg p-6 md:p-10 gacha-card text-center">
        
        <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-6">ğŸ’– ë‘ê·¼ë‘ê·¼ ìƒí’ˆ ë½‘ê¸° ğŸ’–</h1>
        <p class="text-gray-600 mb-8">ë²„íŠ¼ì„ ëˆŒëŸ¬ ì˜¤ëŠ˜ì˜ í–‰ìš´ ìƒí’ˆì„ ë½‘ì•„ë³´ì„¸ìš”!</p>

        <!-- ìƒí’ˆ ëª©ë¡ í‘œì‹œ -->
        <div class="mb-8 p-4 bg-yellow-100 rounded-lg border-2 border-yellow-500">
            <h2 class="text-xl font-bold text-yellow-700 mb-2">ğŸ ì˜¤ëŠ˜ì˜ ìƒí’ˆ ëª©ë¡</h2>
            <ul id="prize-list" class="flex flex-wrap justify-center gap-x-4 gap-y-1 text-base text-gray-700">
                <!-- JSì—ì„œ ì±„ì›Œì§ -->
            </ul>
        </div>
        
        <!-- ë½‘ê¸° ë²„íŠ¼ ì„¹ì…˜ -->
        <div class="flex justify-center mb-10">
            <div class="deco-wrapper">
                <div class="deco-1">ğŸŒŸ</div>
                <div class="deco-2">ğŸ­</div>
                <div class="deco-3">ğŸ‰</div>
                <div class="deco-4">ğŸ</div>
                
                <button id="draw-button" class="gacha-button" onclick="startDraw()">
                    <span>ë½‘ê¸° ì‹œì‘!</span>
                </button>
            </div>
        </div>

        <!-- ê²°ê³¼ ì°½ -->
        <div class="result-box rounded-xl p-4 transition-all duration-300">
            <h3 class="text-xl text-gray-700 font-bold mb-2">ë‹¹ì‹ ì˜ ìƒí’ˆì€...</h3>
            <div id="result-display" class="text-3xl font-black text-indigo-600">
                ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”!
            </div>
        </div>

    </main>
    
    <div id="init-warning" class="fixed top-0 left-0 w-full h-full bg-black/70 flex items-center justify-center hidden z-50">
        <div class="bg-white p-6 rounded-lg text-center shadow-lg">
            <p class="text-xl font-bold mb-4">ğŸ“¢ í„°ì¹˜í•˜ì—¬ íš¨ê³¼ìŒ ê¸°ëŠ¥ì„ í™œì„±í™”í•˜ì„¸ìš”.</p>
            <button onclick="initializeAudio()" class="bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600">ì‹œì‘í•˜ê¸°</button>
        </div>
    </div>


    <script>
        // --- ë°ì´í„° ì„¤ì • ---
        const defaultPrizes = [
            "ì´ˆì½œë¦¿ ğŸ«", 
            "í•˜ë¦¬ë³´ ğŸ»", 
            "ëœë¤ ì§€ìš°ê°œ ë½‘ê¸° âœï¸", 
            "ê¸‰ì‹ 1ë“± íŠ¹ê¶Œ âœ¨", 
            "ì²­ì†Œ ë©´ì œê¶Œ ğŸ¥³",
            "ë¬¸í™”ìƒí’ˆê¶Œ 1,000ì› ğŸ’¸",
            "ë‹¤ìŒ ë²ˆ ë½‘ê¸° ê½ ë©´ì œ âœ…"
        ];
        
        let previousPrize = null;
        let isDrawing = false;
        
        // Tone.jsë¥¼ ìœ„í•œ ë³€ìˆ˜
        let drawSynth;
        let pingSynth;

        // --- Tone.js ì˜¤ë””ì˜¤ ì´ˆê¸°í™” ---
        // ë¸Œë¼ìš°ì € ì •ì±…ìƒ ì‚¬ìš©ì ìƒí˜¸ì‘ìš©(í´ë¦­) í›„ì— ì˜¤ë””ì˜¤ë¥¼ ì´ˆê¸°í™”í•´ì•¼ í•©ë‹ˆë‹¤.
        document.addEventListener('DOMContentLoaded', () => {
             document.getElementById('init-warning').classList.remove('hidden');
        });

        function initializeAudio() {
            // 1. ê¸´ì¥ê° ì¡°ì„±ìš© ë…¸ì´ì¦ˆ
            drawSynth = new Tone.NoiseSynth({
                noise: {
                    type: "pink"
                },
                envelope: {
                    attack: 0.005,
                    decay: 0.1,
                    sustain: 0.2,
                    release: 0.5
                }
            }).toDestination();
            
            // 2. ê²°ê³¼ ë°œí‘œìš© í†¤
            pingSynth = new Tone.Synth({
                oscillator: { type: "sine" },
                envelope: {
                    attack: 0.01,
                    decay: 0.2,
                    sustain: 0.1,
                    release: 0.5
                }
            }).toDestination();

            Tone.start();
            document.getElementById('init-warning').classList.add('hidden');
        }

        // --- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function displayPrizeList() {
            const listEl = document.getElementById('prize-list');
            listEl.innerHTML = defaultPrizes.map(prize => `<li><span class="text-red-500">â˜…</span> ${prize}</li>`).join('');
        }
        
        // --- ë©”ì¸ ë½‘ê¸° ë¡œì§ ---
        function startDraw() {
            if (isDrawing) return; // ì´ë¯¸ ë½‘ê¸° ì¤‘ì´ë¼ë©´ ë¬´ì‹œ

            isDrawing = true;
            const drawButton = document.getElementById('draw-button');
            const resultDisplay = document.getElementById('result-display');
            const resultBox = document.querySelector('.result-box');

            // ë²„íŠ¼ ë¹„í™œì„±í™” ë° ìŠ¤íƒ€ì¼ ë³€ê²½
            drawButton.disabled = true;
            drawButton.classList.add('opacity-50');
            resultBox.classList.remove('pop-result');
            resultDisplay.classList.add('shuffle');

            // ê²°ê³¼ ì´ˆê¸°í™”
            resultDisplay.innerHTML = 'ë‘êµ¬ë‘êµ¬...';
            
            // --- íš¨ê³¼ìŒ ì‹œì‘ (ë‘ê·¼ë‘ê·¼) ---
            if (drawSynth) {
                // ë…¸ì´ì¦ˆì™€ í•¨ê»˜ ë¹ ë¥´ê²Œ í•‘ íš¨ê³¼ ë°˜ë³µ
                drawSynth.triggerAttackRelease("4n", Tone.now());
                
                let drawCount = 0;
                const totalDraws = 20; // ì…”í”Œ íšŸìˆ˜
                const interval = 150; // ì…”í”Œ ì†ë„ (0.15ì´ˆë§ˆë‹¤)

                // ì…”í”Œ ì• ë‹ˆë©”ì´ì…˜ ë° ì†Œë¦¬
                const drawInterval = setInterval(() => {
                    if (drawCount >= totalDraws) {
                        clearInterval(drawInterval);
                        revealResult();
                        return;
                    }
                    
                    // ë¬´ì‘ìœ„ë¡œ ìƒí’ˆì„ ë¹ ë¥´ê²Œ í‘œì‹œ
                    const randomPrize = defaultPrizes[Math.floor(Math.random() * defaultPrizes.length)];
                    resultDisplay.innerHTML = `<span class="text-xl text-gray-700">${randomPrize}</span>`;
                    
                    // ì§§ì€ ì†Œë¦¬ íš¨ê³¼ ë°˜ë³µ
                    drawSynth.triggerAttackRelease("16n", Tone.now());
                    
                    drawCount++;
                }, interval);
            } else {
                // ì˜¤ë””ì˜¤ ì´ˆê¸°í™”ê°€ ì•ˆëœ ê²½ìš° (í˜¹ì‹œ ëª¨ë¥¼ ìƒí™© ëŒ€ë¹„)
                revealResult();
            }
        }
        
        function revealResult() {
            const drawButton = document.getElementById('draw-button');
            const resultDisplay = document.getElementById('result-display');
            const resultBox = document.querySelector('.result-box');

            // 1. ê²°ê³¼ ë½‘ê¸° (ì´ì „ ìƒí’ˆê³¼ ê²¹ì¹˜ì§€ ì•Šê²Œ ì‹œë„)
            let finalPrize = null;
            let attempts = 0;
            do {
                finalPrize = defaultPrizes[Math.floor(Math.random() * defaultPrizes.length)];
                attempts++;
            } while (finalPrize === previousPrize && defaultPrizes.length > 1 && attempts < 10);
            
            previousPrize = finalPrize;

            // 2. ê²°ê³¼ í‘œì‹œ ë° ì• ë‹ˆë©”ì´ì…˜ ì¢…ë£Œ
            resultDisplay.classList.remove('shuffle');
            resultBox.classList.add('pop-result');
            
            resultDisplay.innerHTML = `<span class="text-5xl">${finalPrize}</span>`;
            
            // 3. íš¨ê³¼ìŒ ì¢…ë£Œ ë° ìŠ¹ë¦¬ í†¤
            if (pingSynth) {
                pingSynth.triggerAttackRelease("C5", "8n");
                pingSynth.triggerAttackRelease("G5", "8n", "+0.15");
                pingSynth.triggerAttackRelease("C6", "4n", "+0.3");
            }
            
            // 4. ë²„íŠ¼ í™œì„±í™”
            setTimeout(() => {
                drawButton.disabled = false;
                drawButton.classList.remove('opacity-50');
                isDrawing = false;
            }, 500); // ì• ë‹ˆë©”ì´ì…˜ í›„ í™œì„±í™”
        }

        // ì´ˆê¸° ë¡œë”© ì‹œ ìƒí’ˆ ëª©ë¡ í‘œì‹œ
        window.onload = displayPrizeList;
    </script>
</body>
</html>
