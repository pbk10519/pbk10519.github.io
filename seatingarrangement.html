<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•™ê¸‰ ìë¦¬ ë°°ì¹˜ ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f3f4f6;
            user-select: none; /* ë“œë˜ê·¸ ì‹œ í…ìŠ¤íŠ¸ ì„ íƒ ë°©ì§€ */
        }

        /* ì±…ìƒ ìŠ¤íƒ€ì¼ */
        .desk {
            transition: all 0.2s ease;
            cursor: move;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .desk:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .desk.dragging {
            opacity: 0.5;
            border: 2px dashed #3b82f6;
        }

        /* ë¹ˆ ê³µê°„(ìŠ¬ë¡¯) ìŠ¤íƒ€ì¼ */
        .desk-slot {
            transition: background-color 0.2s;
        }
        
        .desk-slot.drag-over {
            background-color: #dbeafe; /* dragging over highlight */
            border-radius: 0.5rem;
        }

        /* ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ */
        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .animate-pop {
            animation: popIn 0.3s ease-out forwards;
        }

        .filled-seat {
            background-color: #d1fae5; /* ë°°ì • ì™„ë£Œ ìƒ‰ìƒ */
            border-color: #10b981;
            color: #065f46;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center py-10 px-4">

    <!-- í—¤ë” -->
    <header class="text-center mb-10">
        <h1 class="text-4xl font-bold text-gray-800 mb-2">ğŸ« í•™ê¸‰ ìë¦¬ ë°°ì¹˜</h1>
        <p class="text-gray-600">í•™ìƒ ìˆ˜ë¥¼ ì…ë ¥í•˜ê³  ë“œë˜ê·¸í•˜ì—¬ ìë¦¬ë¥¼ ë°°ì¹˜í•´ë³´ì„¸ìš”.</p>
    </header>

    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <main class="w-full max-w-6xl bg-white rounded-xl shadow-lg p-6 md:p-10">
        
        <!-- STEP 1: í•™ìƒ ìˆ˜ ì…ë ¥ -->
        <section id="step-1" class="flex flex-col items-center justify-center space-y-6">
            <div class="text-center">
                <label for="student-count" class="block text-xl font-bold text-gray-700 mb-2">í•™ìƒ ìˆ˜ ì…ë ¥</label>
                <input type="number" id="student-count" min="1" max="50" value="24" 
                    class="w-32 text-center text-2xl border-2 border-gray-300 rounded-lg p-2 focus:outline-none focus:border-blue-500 transition">
            </div>
            <button onclick="goToStep2()" 
                class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg text-lg transition shadow-md">
                ë‹¤ìŒ: ì´ë¦„ ì…ë ¥í•˜ê¸°
            </button>
        </section>

        <!-- STEP 2: ì´ë¦„ ì…ë ¥ -->
        <section id="step-2" class="hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-700">í•™ìƒ ì´ë¦„ í™•ì¸ ë° ìˆ˜ì •</h2>
                <button onclick="goToStep3()" 
                    class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg transition shadow-md">
                    ë°°ì¹˜ ëª¨ë“œë¡œ ì´ë™ &rarr;
                </button>
            </div>
            <div class="mb-4 text-sm text-gray-500 text-right">
                * ì´ë¦„ì„ í´ë¦­í•˜ì—¬ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </div>
            <div id="name-input-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                <!-- ì´ë¦„ ì…ë ¥ ì¸í’‹ë“¤ì´ ìƒì„±ë˜ëŠ” ê³³ -->
            </div>
        </section>

        <!-- STEP 3: ì±…ìƒ ë°°ì¹˜ ë° ë°°ì • -->
        <section id="step-3" class="hidden">
            <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                <div>
                    <h2 class="text-2xl font-bold text-gray-700">ìë¦¬ ë°°ì¹˜ ë° ë°°ì •</h2>
                    <p class="text-sm text-gray-500">ì±…ìƒì„ ë“œë˜ê·¸í•˜ì—¬ ìœ„ì¹˜ë¥¼ ë°”ê¿€ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                </div>
                <div class="flex gap-2">
                    <button onclick="resetLayout()" 
                        class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition">
                        ì´ˆê¸°í™”
                    </button>
                    <button onclick="assignSeats()" 
                        class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-lg transition shadow-md transform hover:scale-105">
                        ğŸ² ìë¦¬ ë°°ì •í•˜ê¸°
                    </button>
                </div>
            </div>

            <!-- êµì‹¤ ì˜ì—­ -->
            <div class="bg-amber-100 border-4 border-amber-200 rounded-xl p-6 relative overflow-x-auto">
                <div class="text-center mb-4 opacity-50 font-bold text-amber-800">ğŸ“‹ ì¹ íŒ (êµíƒ)</div>
                
                <!-- ì±…ìƒ ê·¸ë¦¬ë“œ (6ì—´ ê¸°ì¤€) -->
                <div id="classroom-grid" class="grid grid-cols-6 gap-4 min-w-[800px] mx-auto">
                    <!-- ì±…ìƒ ìŠ¬ë¡¯ë“¤ì´ ìƒì„±ë˜ëŠ” ê³³ -->
                </div>
            </div>
        </section>

    </main>

    <!-- ëª¨ë‹¬ (ì•Œë¦¼ìš©) -->
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-lg shadow-xl text-center max-w-sm mx-4">
            <p id="modal-msg" class="text-lg font-bold mb-4">ë©”ì‹œì§€</p>
            <button onclick="closeModal()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">í™•ì¸</button>
        </div>
    </div>

    <script>
        // --- ë°ì´í„° ë° ìƒíƒœ ë³€ìˆ˜ ---
        let studentCount = 0;
        let studentNames = [];
        let deskLayout = []; // ì±…ìƒì˜ ìœ„ì¹˜ ì •ë³´ë¥¼ ë‹´ì„ ë°°ì—´
        
        // ëœë¤ ì´ë¦„ ìƒì„±ì„ ìœ„í•œ ë°ì´í„°
        const lastNames = ['ê¹€', 'ì´', 'ë°•', 'ìµœ', 'ì •', 'ê°•', 'ì¡°', 'ìœ¤', 'ì¥', 'ì„', 'í•œ', 'ì˜¤', 'ì„œ', 'ì‹ ', 'ê¶Œ', 'í™©', 'ì•ˆ', 'ì†¡', 'ë¥˜', 'ì „'];
        const firstNames = ['ë¯¼ì¤€', 'ì„œì¤€', 'ë„ìœ¤', 'ì˜ˆì¤€', 'ì‹œìš°', 'í•˜ì¤€', 'ì§€í˜¸', 'ì§€í›„', 'ì¤€ìš°', 'ì¤€ì„œ', 'ì„œì—°', 'ì„œìœ¤', 'ì§€ìš°', 'ì„œí˜„', 'í•˜ì€', 'ì§€ë¯¼', 'ë¯¼ì„œ', 'ì§€ìœ ', 'ìœ¤ì„œ', 'ì±„ì›'];

        // --- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---
        function generateRandomName() {
            const last = lastNames[Math.floor(Math.random() * lastNames.length)];
            const first = firstNames[Math.floor(Math.random() * firstNames.length)];
            return last + first;
        }

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function showAlert(msg) {
            document.getElementById('modal-msg').innerText = msg;
            document.getElementById('modal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('modal').classList.add('hidden');
        }

        // --- STEP 1 -> STEP 2 ---
        function goToStep2() {
            const countInput = document.getElementById('student-count');
            const count = parseInt(countInput.value);

            if (!count || count < 1) {
                showAlert("ì˜¬ë°”ë¥¸ í•™ìƒ ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                return;
            }

            studentCount = count;
            studentNames = [];
            
            // ì´ë¦„ ìƒì„± ë° UI ë Œë”ë§
            const grid = document.getElementById('name-input-grid');
            grid.innerHTML = '';

            for (let i = 0; i < studentCount; i++) {
                const name = generateRandomName();
                studentNames.push(name);

                const wrapper = document.createElement('div');
                wrapper.className = 'flex flex-col';
                
                const label = document.createElement('label');
                label.innerText = `í•™ìƒ ${i + 1}`;
                label.className = 'text-xs text-gray-500 mb-1';

                const input = document.createElement('input');
                input.type = 'text';
                input.value = name;
                input.id = `student-name-${i}`;
                input.className = 'border border-gray-300 rounded p-2 focus:ring-2 focus:ring-green-400 focus:outline-none text-center font-medium';
                input.onchange = (e) => { studentNames[i] = e.target.value; };

                wrapper.appendChild(label);
                wrapper.appendChild(input);
                grid.appendChild(wrapper);
            }

            // í™”ë©´ ì „í™˜
            document.getElementById('step-1').classList.add('hidden');
            document.getElementById('step-2').classList.remove('hidden');
        }

        // --- STEP 2 -> STEP 3 ---
        function goToStep3() {
            // í˜„ì¬ ì…ë ¥ëœ ì´ë¦„ë“¤ ìµœì‹ í™”
            for (let i = 0; i < studentCount; i++) {
                const input = document.getElementById(`student-name-${i}`);
                if (input.value.trim() === '') {
                    showAlert(`${i+1}ë²ˆì§¸ í•™ìƒì˜ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.`);
                    return;
                }
                studentNames[i] = input.value.trim();
            }

            // í™”ë©´ ì „í™˜
            document.getElementById('step-2').classList.add('hidden');
            document.getElementById('step-3').classList.remove('hidden');

            renderClassroom();
        }

        // --- êµì‹¤ ë Œë”ë§ ë° ë“œë˜ê·¸ ì•¤ ë“œë¡­ ë¡œì§ ---
        
        let draggedDesk = null;

        function renderClassroom() {
            const grid = document.getElementById('classroom-grid');
            grid.innerHTML = '';

            // ê¸°ë³¸ 6ì—´ 4í–‰ = 24ê°œ. í•™ìƒ ìˆ˜ê°€ ë” ë§ìœ¼ë©´ í–‰ì„ ëŠ˜ë¦¼.
            const totalSlots = Math.max(24, Math.ceil(studentCount / 6) * 6);
            
            // ìŠ¬ë¡¯ ìƒì„±
            for (let i = 0; i < totalSlots; i++) {
                const slot = document.createElement('div');
                slot.className = 'desk-slot w-full h-24 bg-amber-50 rounded-lg border-2 border-dashed border-amber-200 flex items-center justify-center relative';
                slot.dataset.index = i;

                // ë“œë˜ê·¸ ì´ë²¤íŠ¸ (Slot)
                slot.addEventListener('dragover', handleDragOver);
                slot.addEventListener('dragleave', handleDragLeave);
                slot.addEventListener('drop', handleDrop);

                // ì±…ìƒ ì¶”ê°€ (ê¸°ë³¸ì ìœ¼ë¡œ ìˆœì„œëŒ€ë¡œ ì±„ì›€, í•™ìƒ ìˆ˜ë§Œí¼)
                if (i < studentCount) {
                    const desk = createDeskElement(i);
                    slot.appendChild(desk);
                } else if (i < 24) {
                    // í•™ìƒ ìˆ˜ë³´ë‹¤ ë§ì§€ë§Œ ê¸°ë³¸ 24ê°œê¹Œì§€ëŠ” ë¹ˆ ì±…ìƒ ë°°ì¹˜
                    const desk = createDeskElement(null); // ë¹ˆ ì±…ìƒ
                    slot.appendChild(desk);
                }

                grid.appendChild(slot);
            }
        }

        function createDeskElement(id) {
            const desk = document.createElement('div');
            desk.className = 'desk w-full h-full bg-white rounded-lg border border-gray-300 shadow-sm flex flex-col items-center justify-center p-1 select-none z-10';
            desk.draggable = true;
            
            // ë“œë˜ê·¸ ì´ë²¤íŠ¸ (Desk)
            desk.addEventListener('dragstart', handleDragStart);
            desk.addEventListener('dragend', handleDragEnd);

            // ë‚´ìš©ë¬¼
            const icon = document.createElement('div');
            icon.innerText = 'ğŸª‘';
            icon.className = 'text-2xl mb-1';
            
            const nameTag = document.createElement('div');
            nameTag.className = 'student-name font-bold text-gray-700 text-sm md:text-base break-keep text-center';
            nameTag.innerText = id !== null ? 'ë¹ˆ ìë¦¬' : 'ì—¬ë¶„'; // ì´ˆê¸° ìƒíƒœ
            
            // ë°ì´í„° ì†ì„± (ë‚˜ì¤‘ì— ë°°ì • ì‹œ ì‹ë³„ìš©)
            desk.dataset.hasDesk = "true";

            desk.appendChild(icon);
            desk.appendChild(nameTag);

            return desk;
        }

        // --- Drag & Drop Event Handlers ---

        function handleDragStart(e) {
            draggedDesk = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            // ê³ ìŠ¤íŠ¸ ì´ë¯¸ì§€ ì„¤ì • (ì„ íƒ ì‚¬í•­)
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
            draggedDesk = null;
            // ëª¨ë“  ìŠ¬ë¡¯ì˜ í•˜ì´ë¼ì´íŠ¸ ì œê±°
            document.querySelectorAll('.desk-slot').forEach(slot => {
                slot.classList.remove('drag-over');
            });
        }

        function handleDragOver(e) {
            e.preventDefault(); // ë“œë¡­ í—ˆìš©
            e.dataTransfer.dropEffect = 'move';
            this.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            this.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            this.classList.remove('drag-over');

            if (!draggedDesk) return;

            const targetSlot = this;
            const sourceSlot = draggedDesk.parentNode;

            if (targetSlot === sourceSlot) return;

            // íƒ€ê²Ÿ ìŠ¬ë¡¯ì— ì´ë¯¸ ì±…ìƒì´ ìˆëŠ” ê²½ìš° (Swap)
            const existingDesk = targetSlot.querySelector('.desk');

            if (existingDesk) {
                // ì„œë¡œ êµí™˜
                sourceSlot.appendChild(existingDesk);
                targetSlot.appendChild(draggedDesk);
            } else {
                // ë¹ˆ ê³³ìœ¼ë¡œ ì´ë™
                targetSlot.appendChild(draggedDesk);
            }
        }

        // --- ìë¦¬ ë°°ì • ë¡œì§ ---

        function assignSeats() {
            const allDesks = document.querySelectorAll('.desk');
            const deskCount = allDesks.length;
            
            // í•™ìƒì´ ì±…ìƒë³´ë‹¤ ë§ìœ¼ë©´ ê²½ê³  (ê·¸ëŸ´ ì¼ì€ ì—†ë„ë¡ ë¡œì§ ì§°ì§€ë§Œ ì•ˆì „ì¥ì¹˜)
            if (studentNames.length > deskCount) {
                showAlert("í•™ìƒ ìˆ˜ë³´ë‹¤ ì±…ìƒì´ ë¶€ì¡±í•©ë‹ˆë‹¤!");
                return;
            }

            // ëœë¤ ì…”í”Œ
            let shuffledNames = [...studentNames];
            shuffle(shuffledNames);

            // ì´ˆê¸°í™” (ìƒ‰ìƒ ë° í…ìŠ¤íŠ¸)
            allDesks.forEach(desk => {
                const nameTag = desk.querySelector('.student-name');
                nameTag.innerText = '...';
                desk.classList.remove('filled-seat', 'animate-pop');
            });

            // ì•½ê°„ì˜ ë”œë ˆì´ í›„ ë°°ì • (ë‘ê·¼ë‘ê·¼ íš¨ê³¼)
            setTimeout(() => {
                allDesks.forEach((desk, index) => {
                    const nameTag = desk.querySelector('.student-name');
                    
                    // ì±…ìƒ ìˆœì„œëŒ€ë¡œê°€ ì•„ë‹ˆë¼, DOMì— ìˆëŠ” ì±…ìƒ ìˆœì„œëŒ€ë¡œ í•™ìƒì„ ì•‰í˜
                    // ë§Œì•½ ë¹ˆ ì±…ìƒ(ì—¬ë¶„)ì´ì–´ì•¼ í•œë‹¤ë©´ ë¹„ì›€
                    
                    if (index < shuffledNames.length) {
                        nameTag.innerText = shuffledNames[index];
                        desk.classList.add('filled-seat', 'animate-pop');
                    } else {
                        nameTag.innerText = 'ë¹ˆ ìë¦¬';
                        desk.classList.remove('filled-seat');
                    }
                });
            }, 300);
        }

        function resetLayout() {
            if(confirm("ë°°ì¹˜ë¥¼ ì´ˆê¸°í™” í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                renderClassroom();
            }
        }

    </script>
</body>
</html>
